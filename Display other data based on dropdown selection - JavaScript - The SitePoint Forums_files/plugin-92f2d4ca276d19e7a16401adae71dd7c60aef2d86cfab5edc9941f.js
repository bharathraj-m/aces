define("discourse/plugins/discourse-akismet/admin/models/akismet-queue",["discourse/lib/ajax","exports"],function(e,t){"use strict";var n=e.ajax;t.default={confirmSpam:function(e){return n("/admin/plugins/akismet/confirm_spam",{type:"POST",data:{post_id:e.get("id")}})},allow:function(e){return n("/admin/plugins/akismet/allow",{type:"POST",data:{post_id:e.get("id")}})},dismiss:function(e){return n("/admin/plugins/akismet/dismiss",{type:"POST",data:{post_id:e.get("id")}})},deleteUser:function(e){return n("/admin/plugins/akismet/delete_user",{type:"DELETE",data:{user_id:e.get("user_id"),post_id:e.get("id")}})},findAll:function(){return n("/admin/plugins/akismet/index.json").then(function(e){return e.posts=e.posts.map(function(e){return Discourse.Post.create(e)}),e})}}}),Ember.TEMPLATES["javascripts/connectors/site-map-links/akismet-review"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["currentUser","staff"]]],null,2]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","        "],["open-element","span",[]],["static-attr","class","badge-notification flagged-posts"],["flush-element"],["append",["unknown",["currentUser","akismet_review_count"]],false],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["append",["helper",["i18n"],["akismet.title"],null],false],["text","\\n"],["block",["if"],[["get",["currentUser","akismet_review_count"]]],null,0]],"locals":[]},{"statements":[["text","  "],["open-element","li",[]],["flush-element"],["text","\\n"],["block",["link-to"],["adminPlugins.akismet"],null,1],["text","  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/connectors/site-map-links/akismet-review"}}),Ember.TEMPLATES["javascripts/admin/plugins-akismet"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["enabled"]]],null,8,1]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","    "],["append",["helper",["d-button"],null,[["label","icon","class","action"],["akismet.change_settings","gear","settings-button","showSettings"]]],false],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["currentUser","admin"]]],null,0],["text","  "],["append",["helper",["i18n"],["akismet.not_enabled"],null],true],["text","\\n"]],"locals":[]},{"statements":[["text","                  "],["append",["helper",["d-button"],null,[["action","actionParam","icon","class","label","disabled"],["deleteUser",["get",["post"]],"trash-o","btn-danger","akismet.confirm_delete",["get",["performingAction"]]]]],false],["text","\\n"]],"locals":[]},{"statements":[["append",["helper",["avatar"],[["get",["post"]]],[["imageSize"],["small"]]],false],["text"," "],["append",["unknown",["post","username"]],false]],"locals":[]},{"statements":[["text","          "],["open-element","tr",[]],["flush-element"],["text","\\n            "],["open-element","td",[]],["static-attr","class","cooked"],["flush-element"],["text","\\n\\n              "],["open-element","div",[]],["static-attr","class","post-info"],["flush-element"],["text","\\n                "],["block",["link-to"],["adminUser",["get",["post","user_id"]],["get",["post","username"]]],null,3],["text","\\n                "],["open-element","a",[]],["dynamic-attr","href",["unknown",["post","url"]],null],["static-attr","target","_blank"],["static-attr","class","post-link"],["flush-element"],["text","#"],["append",["unknown",["post","id"]],false],["close-element"],["text","\\n              "],["close-element"],["text","\\n              "],["append",["unknown",["post","cooked"]],true],["text","\\n              "],["open-element","div",[]],["static-attr","class","queue-actions"],["flush-element"],["text","\\n                "],["append",["helper",["d-button"],null,[["action","actionParam","icon","class","label","disabled"],["confirmSpamPost",["get",["post"]],"check","btn-primary","akismet.confirm_spam",["get",["performingAction"]]]]],false],["text","\\n\\n                "],["append",["helper",["d-button"],null,[["action","actionParam","icon","label","disabled"],["allowPost",["get",["post"]],"thumbs-o-up","akismet.not_spam",["get",["performingAction"]]]]],false],["text","\\n\\n                "],["append",["helper",["d-button"],null,[["action","actionParam","icon","label","disabled"],["dismiss",["get",["post"]],"times","akismet.dismiss",["get",["performingAction"]]]]],false],["text","\\n\\n\\n"],["block",["if"],[["get",["post","user_id"]]],null,2],["text","              "],["close-element"],["text","\\n            "],["close-element"],["text","\\n          "],["close-element"],["text","\\n"]],"locals":["post"]},{"statements":[["text","    "],["open-element","h3",[]],["static-attr","class","review-queue"],["flush-element"],["append",["helper",["i18n"],["akismet.posts_to_review"],null],false],["close-element"],["text","\\n\\n    "],["open-element","div",[]],["static-attr","class","row"],["flush-element"],["text","\\n      "],["open-element","table",[]],["static-attr","class","akismet-queue"],["flush-element"],["text","\\n        "],["open-element","tbody",[]],["flush-element"],["text","\\n"],["block",["each"],[["get",["sortedPosts"]]],null,4],["text","        "],["close-element"],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["append",["helper",["d-button"],null,[["label","icon","class","action"],["admin.plugins.change_settings","gear","settings-button","showSettings"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","table",[]],["static-attr","class","tbl spam-stats"],["flush-element"],["text","\\n      "],["open-element","tr",[]],["flush-element"],["text","\\n        "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["akismet.stats.scanned"],null],false],["close-element"],["text","\\n        "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["akismet.stats.needs_review"],null],false],["close-element"],["text","\\n        "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["akismet.stats.confirmed_spam"],null],false],["close-element"],["text","\\n        "],["open-element","th",[]],["flush-element"],["append",["helper",["i18n"],["akismet.stats.confirmed_ham"],null],false],["close-element"],["text","\\n      "],["close-element"],["text","\\n      "],["open-element","tr",[]],["flush-element"],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["stats","scanned"]],false],["close-element"],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["stats","needs_review"]],false],["close-element"],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["stats","confirmed_spam"]],false],["close-element"],["text","\\n        "],["open-element","td",[]],["flush-element"],["append",["unknown",["stats","confirmed_ham"]],false],["close-element"],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["stats"]]],null,7],["text","\\n"],["block",["if"],[["get",["currentUser","admin"]]],null,6],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","class","label","disabled"],["refresh","refresh","btn-primary","akismet.refresh",["get",["performingAction"]]]]],false],["text","\\n\\n"],["block",["if"],[["get",["model","length"]]],null,5]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/admin/plugins-akismet"}}),define("discourse/plugins/discourse-akismet/discourse/akismet-route-map",["exports"],function(e){"use strict";e.default={resource:"admin.adminPlugins",path:"/plugins",map:function(){this.route("akismet")}}}),define("discourse/plugins/discourse-akismet/discourse/controllers/admin-plugins-akismet",["discourse/plugins/discourse-akismet/admin/models/akismet-queue","exports"],function(e,t){"use strict";function n(){bootbox.alert(I18n.t("generic_error"))}var s=e.default;t.default=Ember.Controller.extend({sortedPosts:Ember.computed.sort("model","postSorting"),postSorting:["id:asc"],enabled:!1,performingAction:!1,actions:{refresh:function(){var e=this;this.set("performingAction",!0),s.findAll().then(function(t){e.set("stats",t.stats),e.set("model",t.posts)}).catch(n).finally(function(){e.set("performingAction",!1)})},confirmSpamPost:function(e){var t=this;this.set("performingAction",!0),s.confirmSpam(e).then(function(){t.get("model").removeObject(e),t.incrementProperty("stats.confirmed_spam"),t.decrementProperty("stats.needs_review")}).catch(n).finally(function(){t.set("performingAction",!1)})},allowPost:function(e){var t=this;this.set("performingAction",!0),s.allow(e).then(function(){t.incrementProperty("stats.confirmed_ham"),t.decrementProperty("stats.needs_review"),t.get("model").removeObject(e)}).catch(n).finally(function(){t.set("performingAction",!1)})},deleteUser:function(e){var t=this;bootbox.confirm(I18n.t("akismet.delete_prompt",{username:e.get("username")}),function(l){l===!0&&(t.set("performingAction",!0),s.deleteUser(e).then(function(){t.get("model").removeObject(e),t.incrementProperty("stats.confirmed_spam"),t.decrementProperty("stats.needs_review")}).catch(n).finally(function(){t.set("performingAction",!1)}))})},dismiss:function(e){var t=this;this.set("performingAction",!0),s.dismiss(e).then(function(){t.get("model").removeObject(e)}).catch(n).finally(function(){t.set("performingAction",!1)})}}})}),define("discourse/plugins/discourse-akismet/discourse/initializers/add-akismet-count",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";var n=e.withPluginApi;t.default={name:"add-akismet-count",before:"register-discourse-location",after:"inject-objects",initialize:function(e){var t=e.lookup("current-user:main");if(t&&t.get("staff")){var s=!1;if(n("0.4",function(e){e.addFlagProperty("currentUser.akismet_review_count"),s=!0,e.decorateWidget("hamburger-menu:admin-links",function(e){return e.attach("link",{route:"adminPlugins.akismet",label:"akismet.title",badgeCount:"akismet_review_count",badgeClass:"flagged-posts"})})}),!s){var l=require("discourse/controllers/header");l&&l.addFlagProperty&&l.addFlagProperty("currentUser.akismet_review_count")}var a=e.lookup("message-bus:main");a.subscribe("/akismet_counts",function(e){e&&t.set("akismet_review_count",e.akismet_review_count||0)})}}}}),define("discourse/plugins/discourse-akismet/discourse/routes/admin-plugins-akismet",["discourse/plugins/discourse-akismet/admin/models/akismet-queue","exports"],function(e,t){"use strict";var n=e.default;t.default=Discourse.Route.extend({_enabled:!1,_stats:null,model:function(){var e=this;return n.findAll().then(function(t){return e._enabled=t.enabled,e._stats=t.stats,t.posts})},setupController:function(e,t){e.setProperties({model:t,enabled:this._enabled,stats:this._stats})}})}),define("discourse/plugins/discourse-data-explorer/admin/adapters/query",["admin/adapters/build-plugin","exports"],function(e,t){"use strict";var n=e.default;t.default=n("explorer").extend({})}),define("discourse/plugins/discourse-data-explorer/discourse/lib/binary-search",["exports"],function(e){"use strict";function t(e,t,n){for(var s,l=0,a=e.length-1,o=n||"id";l<=a;){if(s=Math.floor((l+a)/2),Em.get(e[s],o)===t)return s;Em.get(e[s],o)<t?l=s+1:a=s-1}return-1}e.default=t}),Discourse.RAW_TEMPLATES["javascripts/explorer/post"]=require("discourse-common/lib/raw-handlebars").template({1:function(e,t,n,s,l){var a;return'<aside class="quote"\n       data-post="'+e.escapeExpression(n.get.call(null!=t?t:{},"post.post_number",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'"\n       data-topic="'+e.escapeExpression(n.get.call(null!=t?t:{},"post.topic_id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'">\n  <div class="title" style="cursor: pointer;">\n  <div class="quote-controls">\n    <a href="/t/via-quote/'+e.escapeExpression(n.get.call(null!=t?t:{},"post.topic_id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/"+e.escapeExpression(n.get.call(null!=t?t:{},"post.post_number",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'"\n         title="go to the quoted post"\n         class="quote-other-topic"></a></div>\n'+e.escapeExpression((n.avatar||t&&t.avatar||n.helperMissing).call(null!=t?t:{},"post",{name:"avatar",hash:{imageSize:"tiny"},hashTypes:{imageSize:"StringLiteral"},hashContexts:{imageSize:t},types:["PathExpression"],contexts:[t],data:l}))+e.escapeExpression(n.get.call(null!=t?t:{},"post.username",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+":</div>\n<blockquote><p>"+(null!=(a=n.get.call(null!=t?t:{},"post.excerpt",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))?a:"")+"</p></blockquote></aside>"},3:function(e,t,n,s,l){return"  "+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){var a;return null!=(a=n.if.call(null!=t?t:{},"post",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),types:["PathExpression"],contexts:[t],data:l}))?a:""},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/text"]=require("discourse-common/lib/raw-handlebars").template({compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){return e.escapeExpression(n.get.call(null!=t?t:{},"value",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"\n"},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/group"]=require("discourse-common/lib/raw-handlebars").template({1:function(e,t,n,s,l){return'  <a href="'+e.escapeExpression(n.get.call(null!=t?t:{},"baseuri",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/groups/"+e.escapeExpression(n.get.call(null!=t?t:{},"group.name",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'">'+e.escapeExpression(n.get.call(null!=t?t:{},"group.name",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"</a>\n"},3:function(e,t,n,s,l){return"  "+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){var a;return null!=(a=n.if.call(null!=t?t:{},"group",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),types:["PathExpression"],contexts:[t],data:l}))?a:""},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/html"]=require("discourse-common/lib/raw-handlebars").template({compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){var a;return(null!=(a=n.get.call(null!=t?t:{},"value",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))?a:"")+"\n"},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/reltime"]=require("discourse-common/lib/raw-handlebars").template({compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){return e.escapeExpression((n.reltime||t&&t.reltime||n.helperMissing).call(null!=t?t:{},"value",{name:"reltime",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"\n"},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/user"]=require("discourse-common/lib/raw-handlebars").template({1:function(e,t,n,s,l){return'  <a href="'+e.escapeExpression(n.get.call(null!=t?t:{},"baseuri",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/users/"+e.escapeExpression(n.get.call(null!=t?t:{},"user.username",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'/activity"\n     data-user-card="'+e.escapeExpression(n.get.call(null!=t?t:{},"user.username",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'">'+e.escapeExpression((n.avatar||t&&t.avatar||n.helperMissing).call(null!=t?t:{},"user",{name:"avatar",hash:{imageSize:"tiny"},hashTypes:{imageSize:"StringLiteral"},hashContexts:{imageSize:t},types:["PathExpression"],contexts:[t],data:l}))+" "+e.escapeExpression(n.get.call(null!=t?t:{},"user.username",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"</a>\n"},3:function(e,t,n,s,l){return"  "+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){var a;return null!=(a=n.if.call(null!=t?t:{},"user",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),types:["PathExpression"],contexts:[t],data:l}))?a:""},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/category"]=require("discourse-common/lib/raw-handlebars").template({1:function(e,t,n,s,l){return"  "+e.escapeExpression((n["category-link"]||t&&t["category-link"]||n.helperMissing).call(null!=t?t:{},"category",{name:"category-link",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"\n"},3:function(e,t,n,s,l){return'  <a href="'+e.escapeExpression(n.get.call(null!=t?t:{},"baseuri",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/t/"+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'">'+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){var a;return null!=(a=n.if.call(null!=t?t:{},"category",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),types:["PathExpression"],contexts:[t],data:l}))?a:""},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/topic"]=require("discourse-common/lib/raw-handlebars").template({1:function(e,t,n,s,l){var a;return'  <a href="'+e.escapeExpression(n.get.call(null!=t?t:{},"baseuri",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/t/"+e.escapeExpression(n.get.call(null!=t?t:{},"topic.slug",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/"+e.escapeExpression(n.get.call(null!=t?t:{},"topic.id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'"\n          >'+(null!=(a=n.get.call(null!=t?t:{},"topic.fancy_title",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))?a:"")+"</a> ("+e.escapeExpression(n.get.call(null!=t?t:{},"topic.posts_count",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+")\n"},3:function(e,t,n,s,l){return'  <a href="'+e.escapeExpression(n.get.call(null!=t?t:{},"baseuri",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/t/"+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'">'+e.escapeExpression(n.get.call(null!=t?t:{},"id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"</a>\n"},compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){var a;return null!=(a=n.if.call(null!=t?t:{},"topic",{name:"if",hash:{},hashTypes:{},hashContexts:{},fn:e.program(1,l,0),inverse:e.program(3,l,0),types:["PathExpression"],contexts:[t],data:l}))?a:""},useData:!0}),Discourse.RAW_TEMPLATES["javascripts/explorer/badge"]=require("discourse-common/lib/raw-handlebars").template({compiler:[7,">= 4.0.0"],main:function(e,t,n,s,l){return'<a href="'+e.escapeExpression(n.get.call(null!=t?t:{},"baseuri",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/badges/"+e.escapeExpression(n.get.call(null!=t?t:{},"badge.id",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"/"+e.escapeExpression(n.get.call(null!=t?t:{},"badge.name",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'"\n   class="user-badge '+e.escapeExpression(n.get.call(null!=t?t:{},"badge.badgeTypeClassName",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'"\n   title="'+e.escapeExpression(n.get.call(null!=t?t:{},"badge.displayDescription",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'"\n   data-badge-name="'+e.escapeExpression(n.get.call(null!=t?t:{},"badge.name",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'">'+e.escapeExpression((n["icon-or-image"]||t&&t["icon-or-image"]||n.helperMissing).call(null!=t?t:{},"badge.icon",{name:"icon-or-image",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+'\n<span class="badge-display-name">'+e.escapeExpression(n.get.call(null!=t?t:{},"badge.displayName",{name:"get",hash:{},hashTypes:{},hashContexts:{},types:["PathExpression"],contexts:[t],data:l}))+"</span></a>\n"},useData:!0}),Ember.TEMPLATES["javascripts/explorer-query-result"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["open-element","div",[]],["static-attr","class","result-info"],["flush-element"],["text","\\n  "],["append",["helper",["i18n"],["explorer.download"],null],false],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","label"],["downloadResultJson","download","explorer.download_json"]]],false],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","label"],["downloadResultCsv","download","explorer.download_csv"]]],false],["text","\\n  "],["open-element","div",[]],["static-attr","class","result-about"],["flush-element"],["text","\\n    "],["append",["unknown",["duration"]],false],["text","\\n  "],["close-element"],["text","\\n"],["close-element"],["block",["if"],[["get",["hasExplain"]]],null,2],["text","\\n"],["open-element","table",[]],["flush-element"],["text","\\n  "],["open-element","thead",[]],["flush-element"],["text","\\n  "],["open-element","tr",[]],["static-attr","class","headers"],["flush-element"],["text","\\n"],["block",["each"],[["get",["columnDispNames"]]],null,1],["text","  "],["close-element"],["text","\\n  "],["close-element"],["text","\\n  "],["open-element","tbody",[]],["flush-element"],["text","\\n"],["block",["each"],[["get",["rows"]]],null,0],["text","  "],["close-element"],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","    "],["append",["helper",["query-row-content"],null,[["row","fallbackTemplate","columnTemplates"],[["get",["row"]],["get",["fallbackTemplate"]],["get",["columnTemplates"]]]]],false],["text","\\n"]],"locals":["row"]},{"statements":[["text","      "],["open-element","th",[]],["flush-element"],["append",["get",["col"]],false],["close-element"],["text","\\n"]],"locals":["col"]},{"statements":[["text","  "],["open-element","pre",[]],["flush-element"],["open-element","code",[]],["flush-element"],["append",["unknown",["content","explain"]],false],["text","\\n  "],["close-element"],["close-element"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/explorer-query-result"}}),Ember.TEMPLATES["javascripts/admin/plugins-explorer"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["explorer-container"],null,[["hideSchema","everEditing"],[["get",["hideSchema"]],["get",["everEditing"]]]],27]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","              "],["open-element","pre",[]],["static-attr","class","query-error"],["flush-element"],["open-element","code",[]],["flush-element"],["append",["get",["err"]],false],["close-element"],["close-element"],["text","\\n"]],"locals":["err"]},{"statements":[["block",["each"],[["get",["results","errors"]]],null,0]],"locals":[]},{"statements":[["text","            "],["append",["helper",["query-result"],null,[["query","content"],[["get",["selectedItem"]],["get",["results"]]]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","        "],["open-element","div",[]],["static-attr","class","query-results"],["flush-element"],["text","\\n"],["block",["if"],[["get",["showResults"]]],null,2,1],["text","        "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["results"]]],null,3]],"locals":[]},{"statements":[["text","          "],["append",["helper",["d-button"],null,[["action","label","disabled","class","type"],["run","explorer.run",["get",["runDisabled"]],"btn-primary","submit"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["append",["helper",["d-button"],null,[["action","label"],["saverun","explorer.saverun"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["append",["helper",["d-button"],null,[["label","disabled","class"],["explorer.run","true","btn-primary"]]],false],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["saveDisabled"]]],null,7,6]],"locals":[]},{"statements":[["text","              "],["append",["helper",["param-input"],null,[["params","info"],[["get",["selectedItem","params"]],["get",["pinfo"]]]]],false],["text","\\n"]],"locals":["pinfo"]},{"statements":[["text","          "],["open-element","div",[]],["static-attr","class","query-params"],["flush-element"],["text","\\n"],["block",["each"],[["get",["selectedItem","param_info"]]],null,9],["text","          "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","                "],["append",["helper",["d-button"],null,[["action","class","icon","label","disabled"],["discard","btn-danger","undo","explorer.undo",["get",["saveDisabled"]]]]],false],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["everEditing"]]],null,11],["text","              "],["append",["helper",["d-button"],null,[["action","class","icon","label"],["destroy","btn-danger","trash","explorer.delete"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","              "],["append",["helper",["d-button"],null,[["action","class","icon","label"],["recover","","undo","explorer.recover"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","              "],["append",["helper",["d-button"],null,[["action","label","icon","class"],["editName","explorer.edit","pencil","btn-primary"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","              "],["append",["helper",["d-button"],null,[["action","label","disabled","class"],["save","explorer.save",["get",["saveDisabled"]],"btn-primary"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["open-element","div",[]],["static-attr","class","sql"],["flush-element"],["text","\\n              "],["append",["helper",["hljs-code-view"],null,[["value","codeClass"],[["get",["selectedItem","sql"]],"sql"]]],false],["text","\\n            "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["open-element","div",[]],["dynamic-attr","class",["concat",["query-editor ",["helper",["if"],[["get",["hideSchema"]],"no-schema"],null]]]],["flush-element"],["text","\\n              "],["open-element","div",[]],["static-attr","class","right-panel"],["flush-element"],["text","\\n                "],["open-element","div",[]],["static-attr","class","schema grippie-target"],["flush-element"],["text","\\n                  "],["append",["helper",["explorer-schema"],null,[["schema","hideSchema"],[["get",["schema"]],["get",["hideSchema"]]]]],false],["text","\\n                "],["close-element"],["text","\\n              "],["close-element"],["text","\\n              "],["open-element","div",[]],["static-attr","class","editor-panel"],["flush-element"],["text","\\n                "],["append",["helper",["ace-editor"],null,[["content","mode"],[["get",["selectedItem","sql"]],"sql"]]],false],["text","\\n              "],["close-element"],["text","\\n              "],["open-element","div",[]],["static-attr","class","grippie"],["flush-element"],["close-element"],["text","\\n              "],["open-element","div",[]],["static-attr","class","clear"],["flush-element"],["close-element"],["text","\\n            "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["open-element","div",[]],["static-attr","class","name"],["flush-element"],["text","\\n              "],["open-element","h2",[]],["flush-element"],["append",["unknown",["selectedItem","name"]],false],["close-element"],["text","\\n              "],["append",["helper",["d-button"],null,[["action","icon","class"],["editName","pencil","no-text btn-small"]]],false],["text","\\n            "],["close-element"],["text","\\n            "],["open-element","div",[]],["static-attr","class","desc"],["flush-element"],["text","\\n              "],["append",["unknown",["selectedItem","description"]],false],["text","\\n            "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["open-element","div",[]],["static-attr","class","name"],["flush-element"],["text","\\n              "],["append",["helper",["text-field"],null,[["value"],[["get",["selectedItem","name"]]]]],false],["text","\\n            "],["close-element"],["text","\\n            "],["open-element","div",[]],["static-attr","class","desc"],["flush-element"],["text","\\n              "],["append",["helper",["textarea"],null,[["value"],[["get",["selectedItem","description"]]]]],false],["text","\\n            "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["editing"]]],null,19,18],["text","\\n"],["block",["if"],[["get",["everEditing"]]],null,17,16],["text","\\n\\n\\n          "],["open-element","div",[]],["static-attr","class","clear"],["flush-element"],["close-element"],["text","\\n          "],["open-element","div",[]],["static-attr","class","pull-left"],["flush-element"],["text","\\n"],["block",["if"],[["get",["everEditing"]]],null,15,14],["text","            "],["append",["helper",["d-button"],null,[["action","label","disabled","icon"],["download","explorer.export",["get",["runDisabled"]],"download"]]],false],["text","\\n          "],["close-element"],["text","\\n          "],["open-element","div",[]],["static-attr","class","pull-right"],["flush-element"],["text","\\n"],["block",["if"],[["get",["selectedItem","destroyed"]]],null,13,12],["text","          "],["close-element"],["text","\\n          "],["open-element","div",[]],["static-attr","class","clear"],["flush-element"],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["dynamic-attr","class",["concat",["query-edit ",["helper",["if"],[["get",["editName"]],"editing"],null]]]],["flush-element"],["text","\\n"],["block",["if"],[["get",["selectedItem"]]],null,20],["text","      "],["close-element"],["text","\\n\\n      "],["open-element","form",[]],["static-attr","class","query-run"],["modifier",["action"],[["get",[null]],"run"],[["on"],["submit"]]],["flush-element"],["text","\\n"],["block",["if"],[["get",["selectedItem","hasParams"]]],null,10],["block",["if"],[["get",["runDisabled"]]],null,8,5],["text","        "],["open-element","label",[]],["static-attr","class","query-plan"],["flush-element"],["append",["helper",["input"],null,[["type","checked","name"],["checkbox",["get",["explain"]],"explain"]]],false],["text"," "],["append",["helper",["i18n"],["explorer.explain_label"],null],false],["close-element"],["text","\\n      "],["close-element"],["text","\\n\\n      "],["open-element","hr",[]],["flush-element"],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["append",["helper",["i18n"],["explorer.no_queries"],null],false],["text"," "],["open-element","a",[]],["modifier",["action"],[["get",[null]],"showCreate"]],["flush-element"],["append",["helper",["i18n"],["explorer.no_queries_hook"],null],false],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","warning"],["flush-element"],["text","\\n        "],["append",["helper",["fa-icon"],["warning"],null],false],["text","\\n        "],["append",["helper",["i18n"],["explorer.others_dirty"],null],false],["text","\\n      "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","query-create"],["flush-element"],["text","\\n        "],["append",["helper",["text-field"],null,[["value","placeholderKey"],[["get",["newQueryName"]],"explorer.create_placeholder"]]],false],["text","\\n        "],["append",["helper",["d-button"],null,[["action","label","icon","class"],["create","explorer.create","plus","btn-primary"]]],false],["text","\\n      "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","div",[]],["static-attr","class","query-list"],["flush-element"],["text","\\n      "],["append",["helper",["combo-box"],null,[["valueAttribute","value","nameProperty","content","castInteger","nameChanges"],["id",["get",["selectedQueryId"]],"listName",["get",["content"]],"true","true"]]],false],["text","\\n      "],["append",["helper",["d-button"],null,[["action","icon","class"],["showCreate","plus","no-text"]]],false],["text","\\n      "],["append",["helper",["d-button"],null,[["action","label","icon"],["importQuery","explorer.import.label","upload"]]],false],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["showCreate"]]],null,24],["text","\\n"],["block",["if"],[["get",["othersDirty"]]],null,23],["text","\\n    "],["open-element","hr",[]],["flush-element"],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["selectedItem","fake"]]],null,22,21],["text","    "],["append",["helper",["conditional-loading-spinner"],null,[["condition"],[["get",["loading"]]]]],false],["text","\\n"],["block",["unless"],[["get",["selectedItem","fake"]]],null,4],["text","\\n    "],["open-element","div",[]],["static-attr","class","explorer-pad-bottom"],["flush-element"],["close-element"],["text","\\n\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","h2",[]],["flush-element"],["append",["helper",["i18n"],["explorer.admins_only"],null],false],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","\\n"],["block",["if"],[["get",["disallow"]]],null,26,25]],"locals":[]}],"hasPartials":false}',
meta:{moduleName:"javascripts/admin/plugins-explorer"}}),Ember.TEMPLATES["javascripts/admin/components/q-params/generic"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["append",["helper",["text-field"],null,[["value"],[["get",["value"]]]]],false],["text","\\n"],["open-element","span",[]],["static-attr","class","param-name"],["flush-element"],["append",["unknown",["info","identifier"]],false],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[],"hasPartials":false}',meta:{moduleName:"javascripts/admin/components/q-params/generic"}}),Ember.TEMPLATES["javascripts/admin/components/q-params/boolean"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["info","nullable"]]],null,1,0],["open-element","span",[]],["static-attr","class","param-name"],["flush-element"],["append",["unknown",["info","identifier"]],false],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["append",["helper",["input"],null,[["type","checked"],["checkbox",["get",["valueBool"]]]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","  "],["append",["helper",["combo-box"],null,[["valueAttribute","value","nameProperty","content"],["id",["get",["value"]],"name",["get",["boolTypes"]]]]],false],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/admin/components/q-params/boolean"}}),Ember.TEMPLATES["javascripts/admin/components/q-params/user_list"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["append",["helper",["user-selector"],null,[["usernames"],[["get",["value"]]]]],false],["text","\\n"],["open-element","span",[]],["static-attr","class","param-name"],["flush-element"],["append",["unknown",["info","identifier"]],false],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[],"hasPartials":false}',meta:{moduleName:"javascripts/admin/components/q-params/user_list"}}),Ember.TEMPLATES["javascripts/admin/components/q-params/int"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["append",["helper",["input"],null,[["type","value"],["number",["get",["value"]]]]],false],["text","\\n"],["open-element","span",[]],["static-attr","class","param-name"],["flush-element"],["append",["unknown",["info","identifier"]],false],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[],"hasPartials":false}',meta:{moduleName:"javascripts/admin/components/q-params/int"}}),Ember.TEMPLATES["javascripts/admin/components/q-params/user_id"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["append",["helper",["user-selector"],null,[["usernames","single"],[["get",["value"]],"true"]]],false],["text","\\n"],["open-element","span",[]],["static-attr","class","param-name"],["flush-element"],["append",["unknown",["info","identifier"]],false],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[],"hasPartials":false}',meta:{moduleName:"javascripts/admin/components/q-params/user_id"}}),Ember.TEMPLATES["javascripts/admin/components/q-params/string"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["append",["helper",["text-field"],null,[["value","type"],[["get",["value"]],"text"]]],false],["text","\\n"],["open-element","span",[]],["static-attr","class","param-name"],["flush-element"],["append",["unknown",["info","identifier"]],false],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[],"hasPartials":false}',meta:{moduleName:"javascripts/admin/components/q-params/string"}}),Ember.TEMPLATES["javascripts/components/explorer-schema-onetable"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["open-element","div",[]],["static-attr","class","schema-table-name"],["flush-element"],["text","\\n"],["block",["if"],[["get",["table","open"]]],null,7,6],["text","  "],["append",["unknown",["table","name"]],false],["text","\\n"],["close-element"],["text","\\n"],["open-element","div",[]],["static-attr","class","schema-table-cols"],["flush-element"],["text","\\n"],["block",["if"],[["get",["table","open"]]],null,5],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","                  "],["append",["helper",["explorer-schema-enuminfo"],null,[["col"],[["get",["col"]]]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","            "],["open-element","i",[]],["static-attr","class","fa fa-info popup-info"],["flush-element"],["text","\\n              "],["open-element","div",[]],["static-attr","class","popup"],["flush-element"],["text","\\n                "],["append",["unknown",["col","column_desc"]],false],["text","\\n"],["block",["if"],[["get",["col","enum"]]],null,0],["text","              "],["close-element"],["text","\\n            "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","          "],["open-element","br",[]],["flush-element"],["close-element"],["text","\\n"],["block",["if"],[["get",["col","havepopup"]]],null,1],["text","          "],["open-element","span",[]],["static-attr","class","schema-typenotes"],["flush-element"],["text","\\n            "],["append",["unknown",["col","notes"]],false],["text","\\n          "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","          "],["open-element","i",[]],["static-attr","class","fa fa-warning"],["flush-element"],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["flush-element"],["text","\\n      "],["open-element","dt",[]],["dynamic-attr","class",["concat",[["helper",["if"],[["get",["col","sensitive"]],"sensitive"],null]]]],["dynamic-attr","title",["concat",[["helper",["if"],[["get",["col","sensitive"]],["helper",["i18n"],["explorer.schema.sensitive"],null]],null]]]],["flush-element"],["text","\\n"],["block",["if"],[["get",["col","sensitive"]]],null,3],["text","        "],["append",["unknown",["col","column_name"]],false],["text","\\n      "],["close-element"],["text","\\n      "],["open-element","dd",[]],["flush-element"],["text","\\n        "],["append",["unknown",["col","data_type"]],false],["text","\\n"],["block",["if"],[["get",["col","havetypeinfo"]]],null,2],["text","      "],["close-element"],["text","\\n      "],["close-element"],["text","\\n"]],"locals":["col"]},{"statements":[["text","    "],["open-element","dl",[]],["flush-element"],["text","\\n"],["block",["each"],[["get",["table","columns"]]],null,4],["text","    "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","i",[]],["static-attr","class","fa fa-caret-right"],["flush-element"],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","i",[]],["static-attr","class","fa fa-caret-down"],["flush-element"],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/components/explorer-schema-onetable"}}),Ember.TEMPLATES["javascripts/components/explorer-schema"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["hideSchema"]]],null,1],["open-element","div",[]],["dynamic-attr","class",["concat",[["helper",["if"],[["get",["hideSchema"]],"hidden"],null]]]],["flush-element"],["text","\\n  "],["append",["helper",["text-field"],null,[["value","placeholderKey"],[["get",["filter"]],"explorer.schema.filter"]]],false],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","class"],["collapseSchema","chevron-right","no-text btn-small"]]],false],["text","\\n  "],["append",["helper",["conditional-loading-spinner"],null,[["condition"],[["get",["loading"]]]]],false],["text","\\n  "],["open-element","div",[]],["static-attr","class","schema-container"],["flush-element"],["text","\\n    "],["open-element","ul",[]],["flush-element"],["text","\\n"],["block",["each"],[["get",["filteredTables"]]],null,0],["text","    "],["close-element"],["text","\\n  "],["close-element"],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","        "],["append",["helper",["explorer-schema-onetable"],null,[["table"],[["get",["table"]]]]],false],["text","\\n"]],"locals":["table"]},{"statements":[["text","  "],["append",["helper",["d-button"],null,[["action","icon","class"],["expandSchema","chevron-left","no-text unhide"]]],false],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/components/explorer-schema"}}),Ember.TEMPLATES["javascripts/components/explorer-schema-enuminfo"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["each"],[["get",["enuminfo"]]],null,0]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["open-element","li",[]],["dynamic-attr","value",["concat",[["unknown",["enum","value"]]]]],["flush-element"],["text","\\n    "],["append",["unknown",["enum","name"]],false],["text","\\n  "],["close-element"],["text","\\n"]],"locals":["enum"]}],"hasPartials":false}',meta:{moduleName:"javascripts/components/explorer-schema-enuminfo"}}),Ember.TEMPLATES["javascripts/modal/import-query"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["title"],["explorer.import.modal"]],0]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["open-element","form",[]],["modifier",["action"],[["get",[null]],"dummy"],[["on"],["submit"]]],["flush-element"],["text","\\n    "],["open-element","div",[]],["static-attr","class","modal-body"],["flush-element"],["text","\\n      "],["append",["helper",["json-file-uploader"],null,[["value","extension"],[["get",["queryFile"]],".dcquery.json"]]],false],["text","\\n    "],["close-element"],["text","\\n    "],["open-element","div",[]],["static-attr","class","modal-footer"],["flush-element"],["text","\\n      "],["append",["helper",["d-button"],null,[["class","action","type","disabled","icon","label"],["btn-primary","doImport","submit",["get",["notReady"]],"plus","explorer.import.label"]]],false],["text","\\n    "],["close-element"],["text","\\n  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/import-query"}}),define("discourse/plugins/discourse-data-explorer/discourse/models/query",["discourse/models/rest","exports"],function(e,t){"use strict";var n=e.default,s=n.extend({dirty:!1,params:{},results:null,_init:function(){this._super(),this.set("dirty",!1)}.on("init"),_initParams:function(){this.resetParams()}.on("init").observes("param_info"),markDirty:function(){this.set("dirty",!0)}.observes("name","description","sql"),markNotDirty:function(){this.set("dirty",!1)},hasParams:function(){return this.get("param_info.length")>0}.property("param_info"),resetParams:function(){var e={},t=this.get("params"),n=this.get("param_info")||[];n.forEach(function(n){var s=n.identifier;t[n.identifier]?e[s]=t[s]:null!==n.default?(n.default===!1,e[s]=n.default):"boolean"===n.type?e[s]="false":e[s]=""}),this.set("params",e)},downloadUrl:function(){return Discourse.getURL("/admin/plugins/explorer/queries/"+this.get("id")+".json?export=1")}.property("id"),listName:function(){var e=this.get("name");return this.get("dirty")&&(e+=" (*)"),this.get("destroyed")&&(e+=" (deleted)"),e}.property("name","dirty","destroyed"),createProperties:function(){return this.get("sql")?this.updateProperties():this.getProperties("name")},updateProperties:function(){var e=this.getProperties(s.updatePropertyNames);return this.get("destroyed")&&(e.id=this.get("id")),e}});s.reopenClass({updatePropertyNames:["name","description","sql"]}),t.default=s}),define("discourse/plugins/discourse-data-explorer/discourse/components/explorer-container",["ember-addons/ember-computed-decorators","exports"],function(e,t){"use strict";function n(e){for(var t={},n=0;n<e.length;n++){var s=e[n],l=s.decorators,a=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),l)for(var o=0;o<l.length;o++){var i=l[o];if("function"!=typeof i)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof i);s=i(t,a,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,a,s)}return t}var s=e.observes;t.default=Ember.Component.extend(n([{key:"_onHideSchema",decorators:[s("hideSchema")],value:function(){this.appEvents.trigger("ace:resize")}},{key:"_onInsertEditor",decorators:[s("everEditing")],value:function(){var e=this;Ember.run.schedule("afterRender",this,function(){return e._bindControls()})}},{key:"_bindControls",value:function(){if("inDOM"===this._state){var e=this.$().find(".query-editor");if(e.length){var t=this.get("grippie");t&&(t.off("mousedown mousemove mouseup"),e.off("mousemove mouseup"));var n=e.find(".grippie"),s=e.find(".ace-wrapper,.grippie-target"),l=$("body"),a=this;this.set("grippie",n);var o=function(e){var t=a.get("startY")-e.screenY,n=a.get("startSize")-t;s.height(n),a.appEvents.trigger("ace:resize")},i=void 0;i=function(e){o(e),l.off("mousemove",o),l.off("mouseup",i),a.set("startY",null),a.set("startSize",null)},n.on("mousedown",function(e){a.set("startY",e.screenY),a.set("startSize",s.height()),l.on("mousemove",o),l.on("mouseup",i),e.preventDefault()})}}}},{key:"didInsertElement",value:function(){this._super(),this._bindControls()}},{key:"willDestroyElement",value:function(){this._super(),this.get("everEditing")&&(this.get("grippie").off("mousedown"),this.set("grippie",null))}}]))}),define("discourse/plugins/discourse-data-explorer/discourse/components/explorer-schema",["discourse/lib/debounce","exports"],function(e,t){"use strict";var n=e.default;t.default=Ember.Component.extend({actions:{expandSchema:function(){this.set("hideSchema",!1)},collapseSchema:function(){this.set("hideSchema",!0)}},transformedSchema:function(){var e=this.get("schema");for(var t in e)e.hasOwnProperty(t)&&e[t].forEach(function(e){var t=[];e.primary&&t.push("primary key"),e.is_nullable&&t.push("null"),e.column_default&&t.push("default "+e.column_default),e.fkey_info&&t.push("fkey "+e.fkey_info),e.denormal&&t.push("denormal "+e.denormal);var n=t.join(", ");n&&(e.notes=n),(e.enum||e.column_desc)&&(e.havepopup=!0),e.havetypeinfo=!!(e.notes||e.enum||e.column_desc)});return e}.property("schema"),rfilter:function(){if(!Em.isBlank(this.get("filter")))return new RegExp(this.get("filter"))}.property("filter"),filterTables:function(e){var t=[],n=this.get("rfilter"),s=!!n;for(var l in e)e.hasOwnProperty(l)&&(s?n.source==l||n.source+"s"==l?t.unshift({name:l,columns:e[l],open:s}):n.test(l)?t.push({name:l,columns:e[l],open:s}):!function(){var a=[];e[l].forEach(function(e){n.source==e.column_name?a.unshift(e):n.test(e.column_name)&&a.push(e)}),Em.isEmpty(a)||t.push({name:l,columns:a,open:s})}():t.push({name:l,columns:e[l],open:!1}));return t},triggerFilter:n(function(){this.set("filteredTables",this.filterTables(this.get("transformedSchema"))),this.set("loading",!1)},500).observes("filter"),setLoading:function(){this.set("loading",!0)}.observes("filter"),init:function(){this._super(),this.set("loading",!0),this.triggerFilter()}})}),define("discourse/plugins/discourse-data-explorer/discourse/components/param-field",["exports"],function(e){"use strict";e.default=Ember.TextField.extend({value:function(e,t,n){return arguments.length>1&&(this.get("params")[this.get("pname")]=t),this.get("params")[this.get("pname")]}.property("params","pname")})}),define("discourse/plugins/discourse-data-explorer/discourse/components/explorer-schema-enuminfo",["exports"],function(e){"use strict";e.default=Ember.Component.extend({tagName:"ol",enuminfo:function(){var e=this.get("col.enum"),t=[];for(var n in e)e.hasOwnProperty(n)&&t.push({value:n,name:e[n]});return t}.property("col.enum")})}),define("discourse/plugins/discourse-data-explorer/discourse/components/explorer-schema-onetable",["exports"],function(e){"use strict";e.default=Ember.Component.extend({classNameBindings:[":schema-table","open"],tagName:"li",open:Em.computed.alias("table.open"),_bindClicks:function(){var e=this;this.$().find(".schema-table-name").click(function(t){e.set("open",!e.get("open")),t.preventDefault()})}.on("didInsertElement"),_cleanup:function(){this.$().find(".schema-table-name").off("click")}.on("willDestroyElement")})}),define("discourse/plugins/discourse-data-explorer/discourse/components/hljs-code-view",["discourse/lib/debounce","discourse/lib/highlight-syntax","discourse-common/lib/buffered-render","exports"],function(e,t,n,s){"use strict";var l=e.default,a=t.default,o=n.bufferedRender;s.default=Ember.Component.extend(o({buildBuffer:function(e){e.push("<pre><code class='"+this.get("codeClass")+"'>"),e.push(Handlebars.Utils.escapeExpression(this.get("value"))),e.push("</code></pre>")},_refreshHighlight:l(function(){this.rerenderBuffer()},50).observes("value"),_applyHighlight:function(){a(this.$())}.on("didInsertElement")}))}),define("discourse/plugins/discourse-data-explorer/discourse/components/query-result",["discourse/lib/ajax","discourse/models/badge","discourse-common/lib/get-owner","exports"],function(e,t,n,s){"use strict";function l(){return"xxxxxxxx".replace(/[xy]/g,function(){return(16*Math.random()|0).toString(16)})}function a(e,t){var n={};return e.forEach(function(e){t?n[e.id]=t.create(e):n[e.id]=e}),n}var o=e.ajax,i=t.default,r=n.getOwner,u=Ember.Component.extend({layoutName:"explorer-query-result",rows:Em.computed.alias("content.rows"),columns:Em.computed.alias("content.columns"),params:Em.computed.alias("content.params"),explainText:Em.computed.alias("content.explain"),hasExplain:Em.computed.notEmpty("content.explain"),colCount:function(){return this.get("content.columns").length}.property("content.columns.length"),duration:function(){return I18n.t("explorer.run_time",{value:I18n.toNumber(this.get("content.duration"),{precision:1})})}.property("content.duration"),parameterAry:function(){var e=[],t=this.get("params");for(var n in t)t.hasOwnProperty(n)&&e.push({key:n,value:t[n]});return e}.property("params.@each"),columnDispNames:function(){return this.get("columns")?this.get("columns").map(function(e){if(e.endsWith("_id"))return e.slice(0,-3);var t=e.indexOf("$");return t>=0?e.substring(t+1):e}):[]}.property("content","columns.@each"),fallbackTemplate:function(){return r(this).lookup("template:explorer/text.raw")}.property(),columnTemplates:function(){var e=this;return this.get("columns")?this.get("columns").map(function(t,n){var s="text";e.get("content.colrender")[n]&&(s=e.get("content.colrender")[n]);var l=r(e).lookup("template:explorer/"+s+".raw");return l||(l=Discourse.RAW_TEMPLATES["javascripts/explorer/"+s]),{name:s,template:l}}):[]}.property("content","columns.@each"),transformedUserTable:function(){return a(this.get("content.relations.user"))}.property("content.relations.user"),transformedBadgeTable:function(){return a(this.get("content.relations.badge"),i)}.property("content.relations.badge"),transformedPostTable:function(){return a(this.get("content.relations.post"))}.property("content.relations.post"),transformedTopicTable:function(){return a(this.get("content.relations.topic"))}.property("content.relations.topic"),transformedGroupTable:function(){return a(this.get("site.groups"))}.property("site.groups"),lookupUser:function(e){return this.get("transformedUserTable")[e]},lookupBadge:function(e){return this.get("transformedBadgeTable")[e]},lookupPost:function(e){return this.get("transformedPostTable")[e]},lookupTopic:function(e){return this.get("transformedTopicTable")[e]},lookupGroup:function(e){return this.get("transformedGroupTable")[e]},lookupCategory:function(e){return this.site.get("categoriesById")[e]},downloadResult:function(e){function t(e,t){var n=void 0;n=document.createElement("input"),n.setAttribute("name",e),n.setAttribute("value",t),a.appendChild(n)}var n=l(),s="<style>body{font-size:36px;display:flex;justify-content:center;align-items:center;}</style><body>Click anywhere to close this window once the download finishes.<script>window.onclick=function(){window.close()};</script>";window.open("data:text/html;base64,"+btoa(s),n);var a=document.createElement("form");a.setAttribute("id","query-download-result"),a.setAttribute("method","post"),a.setAttribute("action",Discourse.getURL("/admin/plugins/explorer/queries/"+this.get("query.id")+"/run."+e+"?download=1")),a.setAttribute("target",n),a.setAttribute("style","display:none;"),t("params",JSON.stringify(this.get("params"))),t("explain",this.get("hasExplain")),t("limit","1000000"),o("/session/csrf.json").then(function(e){t("authenticity_token",e.csrf),document.body.appendChild(a),a.submit(),Em.run.next("afterRender",function(){document.body.removeChild(a)})})},actions:{downloadResultJson:function(){this.downloadResult("json")},downloadResultCsv:function(){this.downloadResult("csv")}}});s.default=u}),define("discourse/plugins/discourse-data-explorer/discourse/components/query-row-content",["discourse/helpers/category-link","discourse/lib/formatter","discourse-common/lib/buffered-render","exports"],function(e,t,n,s){"use strict";function l(e,t){return e=Ember.get(t.contexts[0],e),Ember.isEmpty(e)?"":0===e.indexOf("fa-")?new Handlebars.SafeString("<i class='fa "+e+"'></i>"):new Handlebars.SafeString("<img src='"+e+"'>")}function a(e,t){var n=Ember.get(t.contexts[0],e);return i(n,{allowUncategorized:!0})}function o(e,t){var n=Ember.get(t.contexts[0],e);return new Handlebars.SafeString(r(new Date(n),{title:!0}))}var i=e.categoryLinkHTML,r=t.autoUpdatingRelativeAge,u=n.bufferedRender,c=Handlebars.Utils.escapeExpression,p=Ember.Component.extend(u({tagName:"tr",buildBuffer:function(e){var t=this,n=this.get("row"),s=t.get("parentView"),i=this.get("fallbackTemplate"),r={"icon-or-image":l,"category-link":a,reltime:o},u=this.get("columnTemplates").map(function(e,t){var l=n[t],a=parseInt(l),o={value:l,id:a,baseuri:"/"===Discourse.BaseUri?"":Discourse.BaseUri},u={};if(null===n[t])return"NULL";if("text"===e.name)return c(n[t]);var p=s["lookup"+e.name.capitalize()];p&&(o[e.name]=s["lookup"+e.name.capitalize()](a)),"category"!==e.name&&"badge"!==e.name&&"reltime"!==e.name||(u.helpers=r);try{return new Handlebars.SafeString((e.template||i)(o,u))}catch(e){return console.error(e),"error"}});e.push("<td>"+u.join("</td><td>")+"</td>")}}));s.default=p}),define("discourse/plugins/discourse-data-explorer/discourse/components/param-input",["exports"],function(e){"use strict";function t(){try{var e=document.createElement("input");return e.attributes.type="time",e.attributes.type="date",!0}catch(e){return!1}}var n=Discourse.Category,s={int:"int",bigint:"int",boolean:"boolean",string:"generic",time:"generic",date:"generic",datetime:"generic",double:"string",user_id:"user_id",post_id:"string",topic_id:"generic",category_id:"generic",group_id:"generic",badge_id:"generic",int_list:"generic",string_list:"generic",user_list:"user_list"};e.default=Ember.Component.extend({classNameBindings:["valid:valid:invalid",":param"],boolTypes:[{name:I18n.t("explorer.types.bool.true"),id:"Y"},{name:I18n.t("explorer.types.bool.false"),id:"N"},{name:I18n.t("explorer.types.bool.null_"),id:"#null"}],value:Ember.computed("params","info.identifier",{get:function(){return this.get("params")[this.get("info.identifier")]},set:function(e,t){return this.get("params")[this.get("info.identifier")]=t.toString(),t}}),valueBool:Ember.computed("params","info.identifier",{get:function(){return"false"!==this.get("params")[this.get("info.identifier")]},set:function(e,t){return t=!!t,this.get("params")[this.get("info.identifier")]=t.toString(),t}}),valid:function(){var e=this.get("info.type"),t=this.get("value");if(Em.isEmpty(this.get("value")))return this.get("info.nullable");var s=parseInt(t,10),l=!isNaN(s)&&s<2147483648&&s>-2147483649,a=/^\d+$/.test(t);switch(e){case"int":return/^-?\d+$/.test(t)&&l;case"bigint":return/^-?\d+$/.test(t)&&!isNaN(s);case"boolean":return/^Y|N|#null|true|false/.test(t);case"double":return!isNaN(parseFloat(t))||/^(-?)Inf(inity)?$/i.test(t)||/^(-?)NaN$/i.test(t);case"int_list":return t.split(",").every(function(e){return/^(-?\d+|null)$/.test(e.trim())});case"post_id":return a||/\d+\/\d+(\?u=.*)?$/.test(t);case"category_id":if(a||t===t.dasherize()||this.set("value",t.dasherize()),a)return!!this.site.categories.find(function(e){return e.get("id")===s});if(/\//.test(t)){var o=/(.*)\/(.*)/.exec(t);if(!o)return!1;var i=n.findBySlug(o[2].dasherize(),o[1].dasherize());return!!i}return!!n.findBySlug(t.dasherize());case"group_id":var r=this.site.get("groups");return a?!!r.find(function(e){return e.id===s}):!!r.find(function(e){return e.name===t})}return!0}.property("value","info.type","info.nullable"),layoutType:function(){var e=this.get("info.type");return"time"!==e&&"date"!==e||t()?s[e]?s[e]:"generic":"string"}.property("info.type"),layoutName:function(){return"admin/components/q-params/"+this.get("layoutType")}.property("layoutType")})}),define("discourse/plugins/discourse-data-explorer/discourse/controllers/import-query",["discourse/mixins/modal-functionality","discourse/lib/ajax-error","exports"],function(e,t,n){"use strict";var s=e.default,l=t.popupAjaxError;n.default=Ember.Controller.extend(s,{notReady:Em.computed.not("ready"),needs:["admin-plugins-explorer"],ready:function(){var e=void 0;try{e=JSON.parse(this.get("queryFile"))}catch(e){return!1}return!!e.query}.property("queryFile"),actions:{doImport:function(){var e=this,t=JSON.parse(this.get("queryFile")).query;t.id=0,this.set("loading",!0),this.store.createRecord("query",t).save().then(function(t){e.send("closeModal"),e.set("loading",!1);var n=e.get("controllers.admin-plugins-explorer");n.addCreatedRecord(t.target)}).catch(l)}}})}),define("discourse/plugins/discourse-data-explorer/discourse/controllers/admin-plugins-explorer",["discourse/lib/show-modal","discourse/plugins/discourse-data-explorer/discourse/models/query","discourse/lib/ajax-error","discourse/lib/ajax","exports"],function(e,t,n,s,l){"use strict";var a=e.default,o=t.default,i=n.popupAjaxError,r=s.ajax,u=o.create({name:"No queries",fake:!0});l.default=Ember.Controller.extend({queryParams:{selectedQueryId:"id"},selectedQueryId:null,showResults:!1,hideSchema:!1,loading:!1,explain:!1,saveDisabled:Ember.computed.not("selectedItem.dirty"),runDisabled:Ember.computed.alias("selectedItem.dirty"),results:Em.computed.alias("selectedItem.results"),editing:!1,everEditing:!1,selectedItem:function(){var e=this.get("selectedQueryId"),t=parseInt(e),n=this.get("content").find(function(e){return e.get("id")===t});return n||u}.property("selectedQueryId"),othersDirty:function(){var e=this.get("selectedItem");return!!this.get("content").find(function(t){return t!==e&&t.get("dirty")})}.property("selectedItem","selectedItem.dirty"),setEverEditing:function(){this.get("editing")&&!this.get("everEditing")&&this.set("everEditing",!0)}.observes("editing"),addCreatedRecord:function(e){this.get("model").pushObject(e),this.set("selectedQueryId",Ember.get(e,"id")),this.get("selectedItem").set("dirty",!1),this.set("showResults",!1),this.set("results",null),this.set("editing",!0)},save:function(){var e=this;return this.set("loading",!0),this.get("selectedItem").save().then(function(){var t=e.get("selectedItem");t.markNotDirty(),e.set("editing",!1)}).catch(function(e){throw i(e),e}).finally(function(){e.set("loading",!1)})},actions:{dummy:function(){},importQuery:function(){a("import-query"),this.set("showCreate",!1)},showCreate:function(){this.set("showCreate",!0)},editName:function(){this.set("editing",!0)},download:function(){window.open(this.get("selectedItem.downloadUrl"),"_blank")},resetParams:function(){this.get("selectedItem").resetParams()},saveDefaults:function(){this.get("selectedItem").saveDefaults()},save:function(){this.save()},saverun:function(){var e=this;this.save().then(function(){return e.send("run")})},create:function(){var e=this;this.set("loading",!0),this.set("showCreate",!1);var t=this.store.createRecord("query",{name:this.get("newQueryName")});t.save().then(function(t){e.addCreatedRecord(t.target)}).catch(i).finally(function(){e.set("loading",!1)})},discard:function(){var e=this;this.set("loading",!0),this.store.find("query",this.get("selectedItem.id")).then(function(t){var n=e.get("selectedItem");n.setProperties(t.getProperties(o.updatePropertyNames)),n.markNotDirty(),e.set("editing",!1)}).catch(i).finally(function(){e.set("loading",!1)})},destroy:function(){var e=this,t=this.get("selectedItem");this.set("loading",!0),this.store.destroyRecord("query",t).then(function(){t.set("destroyed",!0)}).catch(i).finally(function(){e.set("loading",!1)})},recover:function(){var e=this,t=this.get("selectedItem");this.set("loading",!0),t.save().then(function(){t.set("destroyed",!1)}).catch(i).finally(function(){e.set("loading",!1)})},run:function(){var e=this;this.get("selectedItem.dirty")||this.get("runDisabled")||(this.set("loading",!0),this.set("showResults",!1),r("/admin/plugins/explorer/queries/"+this.get("selectedItem.id")+"/run",{type:"POST",data:{params:JSON.stringify(this.get("selectedItem.params")),explain:this.get("explain")}}).then(function(t){return e.set("results",t),t.success?void e.set("showResults",!0):void e.set("showResults",!1)}).catch(function(t){e.set("showResults",!1),t.jqXHR&&422===t.jqXHR.status&&t.jqXHR.responseJSON?e.set("results",t.jqXHR.responseJSON):i(t)}).finally(function(){e.set("loading",!1)}))}}})}),define("discourse/plugins/discourse-data-explorer/discourse/explorer-route-map",["exports"],function(e){"use strict";e.default={resource:"admin.adminPlugins",path:"/plugins",map:function(){this.route("explorer")}}}),define("discourse/plugins/discourse-data-explorer/discourse/initializers/initialize-data-explorer",["exports"],function(e){"use strict";e.default={name:"initialize-data-explorer",initialize:function(e){e.lookup("store:main").addPluralization("query","queries"),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){var n=this.toString();(void 0===t||t>n.length)&&(t=n.length),t-=e.length;var s=n.indexOf(e,t);return s!==-1&&s===t}),require("discourse/plugins/discourse-data-explorer/discourse/explorer-route-map")}}}),define("discourse/plugins/discourse-data-explorer/discourse/routes/admin-plugins-explorer",["discourse/lib/ajax","exports"],function(e,t){"use strict";var n=e.ajax;t.default=Discourse.Route.extend({controllerName:"admin-plugins-explorer",model:function(){var e=this.store.findAll("query"),t=n("/admin/plugins/explorer/schema.json",{cache:!0});return e.then(function(e){return e.forEach(function(e){return e.markNotDirty()}),t.then(function(t){return{model:e,schema:t}})}).catch(function(){return t.catch(function(){}),{model:null,schema:null,disallow:!0}})},setupController:function(e,t){e.setProperties(t)}})}),function(e,t){function n(e){e.toggleClass("open")}var s=function(e){var t,n=e.createElement("details");if(!("open"in n))return!1;var s=e.body||function(){var n=e.documentElement;return t=!0,n.insertBefore(e.createElement("body"),n.firstElementChild||n.firstChild)}();n.innerHTML="<summary>a</summary>b",n.style.display="block",s.appendChild(n);var l=n.offsetHeight;return n.open=!0,l=l!==n.offsetHeight,s.removeChild(n),t&&s.parentNode.removeChild(s),l}(e);t.fn.details=function(){return s?this:this.each(function(){var e=t(this),s=t("summary",e).first();s.prop("tabIndex",0),s.on("keydown",function(t){if(32===t.keyCode||13===t.keyCode)return n(e),!1}),s.on("click",function(){s.focus(),n(e)})})}}(document,jQuery),define("discourse/plugins/discourse-details/lib/discourse-markdown/details",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function n(e,t,n){return"<details><summary>"+t+"</summary>"+n+"</details>"}function s(e){for(e=e||"";e!==(e=e.replace(/\[details=([^\]]+)\]((?:(?!\[details=[^\]]+\]|\[\/details\])[\S\s])*)\[\/details\]/gi,n)););return e.replace(/<\/summary>/gi,"</summary>\n\n").replace(/<\/details>/gi,"\n\n</details>\n\n")}function l(e){e.whiteList(["summary","summary[title]","details","details[open]","details.elided"]),
e.addPreProcessor(function(e){return s(e)})}t.setup=l;var a=e.registerOption;a(function(e,t){t.features.details=!0})}),define("discourse/plugins/discourse-details/initializers/apply-details",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";function n(e){e.decorateCooked(function(e){return $("details",e).details()}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"insertDetails",icon:"caret-right",label:"details.title"}});var t=e.container.lookupFactory("controller:composer");t.reopen({actions:{insertDetails:function(){this.get("toolbarEvent").applySurround("[details="+I18n.t("composer.details_title")+"]","[/details]","details_text",{multiline:!1}),this.set("optionsVisible",!1)}}})}var s=e.withPluginApi;t.default={name:"apply-details",initialize:function(){s("0.5",n)}}}),define("discourse/plugins/staff-notes/discourse-staff-notes/lib/staff-notes",["discourse/lib/show-modal","discourse/lib/load-script","exports"],function(e,t,n){"use strict";function s(e,t,n){return a("defer/html-sanitizer-bundle").then(function(){return e.find("staff-note",{user_id:t}).then(function(e){var s=l("staff-notes",{model:e,title:"staff_notes.title",addModalBodyView:!0});return s.reset(),s.set("userId",t),s.set("callback",n),s})})}n.showStaffNotes=s;var l=e.default,a=t.default}),Ember.TEMPLATES["javascripts/discourse-staff-notes/templates/connectors/user-profile-controls/show-notes-on-profile"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["siteSettings","staff_notes_enabled"]]],null,3]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","      "],["open-element","li",[]],["flush-element"],["open-element","a",[]],["static-attr","href",""],["static-attr","class","btn"],["modifier",["action"],[["get",[null]],"showStaffNotes"]],["flush-element"],["append",["helper",["fa-icon"],["pencil"],null],false],["append",["helper",["i18n"],["staff_notes.title"],null],false],["close-element"],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","li",[]],["flush-element"],["open-element","a",[]],["static-attr","href",""],["static-attr","class","btn"],["modifier",["action"],[["get",[null]],"showStaffNotes"]],["flush-element"],["append",["helper",["fa-icon"],["pencil"],null],false],["append",["helper",["i18n"],["staff_notes.show"],[["count"],[["get",["staffNotesCount"]]]]],false],["close-element"],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["block",["if"],[["get",["staffNotesCount"]]],null,1,0]],"locals":[]},{"statements":[["block",["if"],[["get",["currentUser","staff"]]],null,2]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/discourse-staff-notes/templates/connectors/user-profile-controls/show-notes-on-profile"}}),define("discourse/plugins/staff-notes/discourse-staff-notes/connectors/user-profile-controls/show-notes-on-profile",["discourse/plugins/staff-notes/discourse-staff-notes/lib/staff-notes","discourse-common/lib/get-owner","exports"],function(e,t,n){"use strict";var s=e.showStaffNotes,l=t.getOwner;n.default={shouldRender:function(e,t){var n=t.siteSettings,s=t.currentUser;return n.staff_notes_enabled&&s&&s.staff},setupComponent:function(e,t){var n=e.model;t.set("staffNotesCount",n.get("custom_fields.staff_notes_count")||0)},actions:{showStaffNotes:function(){var e=this,t=l(this).lookup("store:main"),n=this.get("args.model");s(t,n.get("id"),function(t){return e.set("staffNotesCount",t)})}}}}),Ember.TEMPLATES["javascripts/modal/staff-notes"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["class"],["staff-notes-modal"]],3]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","            "],["open-element","span",[]],["static-attr","class","controls"],["flush-element"],["text","\\n              "],["append",["helper",["d-button"],null,[["action","actionParam","icon","class","title"],["removeNote",["get",["n"]],"times","btn-small btn-danger","staff_notes.remove"]]],false],["text","\\n            "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","          "],["append",["helper",["avatar"],[["get",["n","created_by"]]],[["imageSize"],["small"]]],false],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","div",[]],["static-attr","class","staff-note"],["flush-element"],["text","\\n      "],["open-element","div",[]],["static-attr","class","posted-by"],["flush-element"],["text","\\n"],["block",["user-link"],null,[["user"],[["get",["n","created_by"]]]],1],["text","      "],["close-element"],["text","\\n      "],["open-element","div",[]],["static-attr","class","note-contents"],["flush-element"],["text","\\n        "],["open-element","div",[]],["static-attr","class","note-info"],["flush-element"],["text","\\n          "],["open-element","span",[]],["static-attr","class","username"],["flush-element"],["append",["unknown",["n","created_by","username"]],false],["close-element"],["text","\\n          "],["open-element","span",[]],["static-attr","class","post-date"],["flush-element"],["append",["helper",["age-with-tooltip"],[["get",["n","created_at"]]],null],false],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["n","can_delete"]]],null,0],["text","        "],["close-element"],["text","\\n\\n        "],["open-element","div",[]],["static-attr","class","cooked"],["flush-element"],["text","\\n          "],["append",["helper",["cook-text"],[["get",["n","raw"]]],null],false],["text","\\n        "],["close-element"],["text","\\n      "],["close-element"],["text","\\n\\n      "],["open-element","div",[]],["static-attr","class","clearfix"],["flush-element"],["close-element"],["text","\\n    "],["close-element"],["text","\\n"]],"locals":["n"]},{"statements":[["block",["each"],[["get",["model"]]],null,2],["text","\\n  "],["append",["helper",["textarea"],null,[["value"],[["get",["newNote"]]]]],false],["text","\\n  "],["append",["helper",["d-button"],null,[["action","label","class","disabled"],["attachNote","staff_notes.attach","btn-primary",["get",["attachDisabled"]]]]],false],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/staff-notes"}}),define("discourse/plugins/staff-notes/discourse/adapters/staff-note",["discourse/adapters/rest","discourse/lib/ajax","exports"],function(e,t,n){"use strict";var s=e.default,l=t.ajax;n.default=s.extend({destroyRecord:function(e,t,n){var s=this.pathFor(e,t,n.get("id")),a=n.get("user_id");return l(s+"?user_id="+a,{method:"DELETE"})}})}),define("discourse/plugins/staff-notes/discourse/controllers/staff-notes",["ember-addons/ember-computed-decorators","discourse/lib/ajax-error","exports"],function(e,t,n){"use strict";function s(e){for(var t={},n=0;n<e.length;n++){var s=e[n],l=s.decorators,a=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),l)for(var o=0;o<l.length;o++){var i=l[o];if("function"!=typeof i)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof i);s=i(t,a,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,a,s)}return t}var l=e.default,a=e.on,o=t.popupAjaxError;n.default=Ember.Controller.extend(s([{key:"newNote",initializer:function(){return null}},{key:"saving",initializer:function(){return!1}},{key:"user",initializer:function(){return null}},{key:"reset",decorators:[a("init")],value:function(){this.setProperties({newNote:null,saving:!1,callback:null})}},{key:"attachDisabled",decorators:[l("newNote","saving")],value:function(e,t){return t||!e||0===e.length}},{key:"_refreshCount",value:function(){var e=this.get("callback");e&&e(this.get("model.length"))}},{key:"actions",initializer:function(){return{attachNote:function(){var e=this,t=this.store.createRecord("staff-note"),n=parseInt(this.get("userId"));this.set("saving",!0),t.save({raw:this.get("newNote"),user_id:n}).then(function(){e.set("newNote",""),e.get("model").pushObject(t),e._refreshCount()}).catch(o).finally(function(){return e.set("saving",!1)})},removeNote:function(e){var t=this;bootbox.confirm(I18n.t("staff_notes.delete_confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(n){n&&e.destroyRecord().then(function(){var n=t.get("model");n.removeObject(e),t._refreshCount()}).catch(o)})}}}}]))}),define("discourse/plugins/staff-notes/discourse/initializers/enable-staff-notes",["discourse/lib/plugin-api","discourse/helpers/fa-icon-node","discourse/plugins/staff-notes/discourse-staff-notes/lib/staff-notes","exports"],function(e,t,n,s){"use strict";var l=e.withPluginApi,a=t.iconNode,o=n.showStaffNotes;s.default={name:"enable-staff-notes",initialize:function(e){var t=e.lookup("site-settings:main"),n=e.lookup("current-user:main");if(t.staff_notes_enabled&&n&&n.staff){var s=e.lookup("store:main");l("0.2",function(n){function l(){var e=this;o(s,this.attrs.user_id,function(t){e.sendWidgetAction("refreshStaffNotes",t)})}n.attachWidgetAction("post","refreshStaffNotes",function(e){var t=this.model.get("user_custom_fields")||{};t.staff_notes_count=e,this.model.set("user_custom_fields",t)});var i=e.lookupFactory("controller:user");i.reopen({staffNotesCount:null,_modelChanged:function(){this.set("staffNotesCount",this.get("model.custom_fields.staff_notes_count")||0)}.observes("model").on("init"),actions:{showStaffNotes:function(){var e=this,t=this.get("model");o(s,t.get("id"),function(t){return e.set("staffNotesCount",t)})}}});var r=n.container.lookup("site:main").mobileView,u=r?"before":"after";n.decorateWidget("poster-name:"+u,function(e){var t=e.attrs.userCustomFields||{};if(t.staff_notes_count>0)return e.attach("staff-notes-icon")}),n.decorateWidget("post-admin-menu:after",function(e){return e.attach("post-admin-menu-button",{icon:"pencil",label:"staff_notes.attach",action:"showStaffNotes"})}),n.attachWidgetAction("post-admin-menu","showStaffNotes",l),n.createWidget("staff-notes-icon",{tagName:"span.staff-notes-icon",click:l,html:function(){return t.enable_emoji?this.attach("emoji",{name:"pencil"}):a("sticky-note")}})})}}}}),Ember.TEMPLATES["javascripts/modal/admin-enable-ssl"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["if"],[["get",["canEnableSsl"]]],null,4,1]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","    "],["open-element","p",[]],["flush-element"],["text","\\n      Your site is currently on a temporary domain at "],["open-element","b",[]],["flush-element"],["text","trydiscourse.com"],["close-element"],["text",".\\n      To enable HTTPS, your site must be on a domain name that you own and control.\\n    "],["close-element"],["text","\\n    "],["open-element","p",[]],["flush-element"],["text","\\n      Please contact us at "],["open-element","a",[]],["static-attr","href","mailto:team@discourse.org"],["flush-element"],["text","team@discourse.org"],["close-element"],["text"," to change your domain name.\\n    "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["block",["d-modal-body"],null,[["class","rawTitle"],["hosted-enable-ssl","Enable SSL"]],0],["text","  "],["open-element","div",[]],["static-attr","class","modal-footer hosted-enable-ssl"],["flush-element"],["text","\\n    "],["open-element","button",[]],["static-attr","class","btn btn-primary"],["modifier",["action"],[["get",[null]],"closeModal"]],["flush-element"],["text","OK"],["close-element"],["text","\\n  "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","p",[]],["flush-element"],["text","Enabling SSL will start your subscription."],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","    "],["open-element","p",[]],["flush-element"],["text","For an additional $20/month, we can:"],["close-element"],["text","\\n\\n    "],["open-element","ul",[]],["flush-element"],["text","\\n      "],["open-element","li",[]],["flush-element"],["text","Double your number of allowed staff users to "],["open-element","b",[]],["flush-element"],["text","10"],["close-element"],["text"," (standard) or "],["open-element","b",[]],["flush-element"],["text","30"],["close-element"],["text"," (business)."],["close-element"],["text","\\n      "],["open-element","li",[]],["flush-element"],["text","Increase your page view limit to "],["open-element","b",[]],["flush-element"],["text","150k"],["close-element"],["text"," (standard) or "],["open-element","b",[]],["flush-element"],["text","650k"],["close-element"],["text"," (business)."],["close-element"],["text","\\n      "],["open-element","li",[]],["flush-element"],["text","Increase your storage to "],["open-element","b",[]],["flush-element"],["text","15gb"],["close-element"],["text"," (standard) or "],["open-element","b",[]],["flush-element"],["text","65gb"],["close-element"],["text"," (business)."],["close-element"],["text","\\n      "],["open-element","li",[]],["flush-element"],["text","Enable HTTPS  we\'ll buy the SSL certificate, set it up and renew it every year on your behalf."],["close-element"],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["startSubscriptionUrl"]]],null,2]],"locals":[]},{"statements":[["block",["d-modal-body"],null,[["class","rawTitle"],["hosted-enable-ssl","Enable SSL"]],3],["text","  "],["open-element","div",[]],["static-attr","class","modal-footer hosted-enable-ssl"],["flush-element"],["text","\\n    "],["open-element","button",[]],["static-attr","class","btn btn-primary"],["modifier",["action"],[["get",[null]],"enableSSL"]],["flush-element"],["text","OK, Enable SSL"],["close-element"],["text","\\n    \\n    "],["open-element","a",[]],["modifier",["action"],[["get",[null]],"closeModal"]],["flush-element"],["text","no thanks"],["close-element"],["text","\\n  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/admin-enable-ssl"}}),Ember.TEMPLATES["javascripts/modal/admin-billing-email"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["class","rawTitle"],["hosted-billing-email","Change Billing Email Address"]],0],["open-element","div",[]],["static-attr","class","modal-footer hosted-billing-email"],["flush-element"],["text","\\n  "],["open-element","button",[]],["static-attr","class","btn btn-primary"],["modifier",["action"],[["get",[null]],"save"]],["flush-element"],["text","Save"],["close-element"],["text","\\n  \\n  "],["open-element","a",[]],["modifier",["action"],[["get",[null]],"closeModal"]],["flush-element"],["text","cancel"],["close-element"],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["open-element","p",[]],["flush-element"],["text","Set the email address where future receipts will be sent."],["close-element"],["text","\\n  "],["open-element","p",[]],["flush-element"],["text","\\n  "],["append",["helper",["text-field"],null,[["value","placeholderKey","id","autocorrect","autocapitalize","type"],[["get",["billingEmail"]],"topic.invite_reply.email_placeholder","hosted-billing-email-input","off","off","email"]]],false],["text","\\n  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/admin-billing-email"}}),Ember.TEMPLATES["javascripts/modal/admin-send-receipt"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["rawTitle","class"],["Send Receipt","hosted-send-receipt"]],0],["open-element","div",[]],["static-attr","class","modal-footer hosted-send-receipt"],["flush-element"],["text","\\n  "],["open-element","button",[]],["static-attr","class","btn btn-primary"],["modifier",["action"],[["get",[null]],"sendReceipt"]],["flush-element"],["text","Yes"],["close-element"],["text","\\n  \\n  "],["open-element","a",[]],["modifier",["action"],[["get",[null]],"closeModal"]],["flush-element"],["text","Cancel"],["close-element"],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","  "],["open-element","p",[]],["flush-element"],["text","\\n    Do you want your last receipt to be emailed to the current billing email address?\\n    "],["open-element","pre",[]],["flush-element"],["append",["unknown",["billingEmailAddress"]],false],["close-element"],["text","\\n  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/admin-send-receipt"}}),define("discourse/plugins/hosted-site/discourse/initializers/anon-init",["ember-addons/ember-computed-decorators","exports"],function(e,t){"use strict";function n(e){for(var t={},n=0;n<e.length;n++){var s=e[n],l=s.decorators,a=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),l)for(var o=0;o<l.length;o++){var i=l[o];if("function"!=typeof i)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof i);s=i(t,a,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,a,s)}return t}var s=e.on;t.default={name:"apply-anon-init",initialize:function(e){var t=e.lookupFactory("component:global-notice");t&&t.reopen(n([{key:"_hideOtherAlerts",decorators:[s("didInsertElement")],value:function(){Em.run.schedule("afterRender",function(){($(".alert .trial-expired-message").size()>0||$(".alert .discourse-hosting-readonly").size()>0)&&($(".alert-read-only").hide(),$(".alert-too-few-topics").hide())})}}]))}}}),function(e){"use strict";function t(e,t){var n,s,l,a=e.data("width"),o=e.data("height"),i=e.data("ratio")?e.data("ratio"):t.default_ratio,r=e.data("youtube-id"),u=e.data("youtube-title"),c=[],p=e.data("parameters")||"";i=i.split(":"),"number"==typeof a&&"number"==typeof o?(e.width(a),n=o+"px"):"number"==typeof a?(e.width(a),n=a*i[1]/i[0]+"px"):(a=e.width(),0===a&&(a=e.parent().width()),n=i[1]/i[0]*100+"%"),c.push('<div class="ytp-thumbnail">'),c.push('<div class="ytp-large-play-button"'),a<=640&&c.push(' style="transform: scale(0.563888888888889);"'),c.push(">"),c.push("<svg>"),c.push('<path fill-rule="evenodd" clip-rule="evenodd" fill="#1F1F1F" class="ytp-large-play-button-svg" d="M84.15,26.4v6.35c0,2.833-0.15,5.967-0.45,9.4c-0.133,1.7-0.267,3.117-0.4,4.25l-0.15,0.95c-0.167,0.767-0.367,1.517-0.6,2.25c-0.667,2.367-1.533,4.083-2.6,5.15c-1.367,1.4-2.967,2.383-4.8,2.95c-0.633,0.2-1.316,0.333-2.05,0.4c-0.767,0.1-1.3,0.167-1.6,0.2c-4.9,0.367-11.283,0.617-19.15,0.75c-2.434,0.034-4.883,0.067-7.35,0.1h-2.95C38.417,59.117,34.5,59.067,30.3,59c-8.433-0.167-14.05-0.383-16.85-0.65c-0.067-0.033-0.667-0.117-1.8-0.25c-0.9-0.133-1.683-0.283-2.35-0.45c-2.066-0.533-3.783-1.5-5.15-2.9c-1.033-1.067-1.9-2.783-2.6-5.15C1.317,48.867,1.133,48.117,1,47.35L0.8,46.4c-0.133-1.133-0.267-2.55-0.4-4.25C0.133,38.717,0,35.583,0,32.75V26.4c0-2.833,0.133-5.95,0.4-9.35l0.4-4.25c0.167-0.966,0.417-2.05,0.75-3.25c0.7-2.333,1.567-4.033,2.6-5.1c1.367-1.434,2.967-2.434,4.8-3c0.633-0.167,1.333-0.3,2.1-0.4c0.4-0.066,0.917-0.133,1.55-0.2c4.9-0.333,11.283-0.567,19.15-0.7C35.65,0.05,39.083,0,42.05,0L45,0.05c2.467,0,4.933,0.034,7.4,0.1c7.833,0.133,14.2,0.367,19.1,0.7c0.3,0.033,0.833,0.1,1.6,0.2c0.733,0.1,1.417,0.233,2.05,0.4c1.833,0.566,3.434,1.566,4.8,3c1.066,1.066,1.933,2.767,2.6,5.1c0.367,1.2,0.617,2.284,0.75,3.25l0.4,4.25C84,20.45,84.15,23.567,84.15,26.4z M33.3,41.4L56,29.6L33.3,17.75V41.4z"></path>'),c.push('<polygon fill-rule="evenodd" clip-rule="evenodd" fill="#FFFFFF" points="33.3,41.4 33.3,17.75 56,29.6"></polygon>'),c.push("</svg>"),c.push("</div>"),c.push("</div>"),c.push('<div class="html5-info-bar">'),c.push('<div class="html5-title">'),c.push('<div class="html5-title-text-wrapper">'),c.push('<a class="html5-title-text" target="_blank" tabindex="3100" href="https://www.youtube.com/watch?v=',r,'">'),void 0===u||null===u||""===u?c.push("youtube.com/watch?v="+r):c.push(u),c.push("</a>"),c.push("</div>"),c.push("</div>"),c.push("</div>"),e.css({"padding-bottom":n}).html(c.join("")),l=a>640?"maxresdefault.jpg":a>480?"sddefault.jpg":a>320?"hqdefault.jpg":a>120?"mqdefault.jpg":0===a?"hqdefault.jpg":"default.jpg",s=e.find(".ytp-thumbnail").css({"background-image":["url(//img.youtube.com/vi/",r,"/",l,")"].join("")}).addClass("lazyYT-image-loaded").on("click",function(n){n.preventDefault(),!e.hasClass("lazyYT-video-loaded")&&s.hasClass("lazyYT-image-loaded")&&e.html('<iframe src="//www.youtube.com/embed/'+r+"?autoplay=1&"+p+'" frameborder="0" allowfullscreen></iframe>').addClass("lazyYT-video-loaded"),t.onPlay&&t.onPlay(n,e)})}e.fn.lazyYT=function(n){var s={default_ratio:"16:9",callback:null,container_class:"lazyYT-container"},l=e.extend(s,n);return this.each(function(){var n=e(this).addClass(l.container_class);t(n,l)})}}(jQuery),function(e){e.fn.iframeTracker=function(t){var n=this.get();if(null===t||t===!1)e.iframeTracker.untrack(n);else{if("object"!=typeof t)throw new Error("Wrong handler type (must be an object, or null|false to untrack)");e.iframeTracker.track(n,t)}},e.iframeTracker={focusRetriever:null,focusRetrieved:!1,handlersList:[],isIE8AndOlder:!1,init:function(){try{1==e.browser.msie&&e.browser.version<9&&(this.isIE8AndOlder=!0)}catch(e){try{var t=navigator.userAgent.match(/(msie) ([\w.]+)/i);t[2]<9&&(this.isIE8AndOlder=!0)}catch(e){}}if(e(window).focus(),e(window).blur(function(t){e.iframeTracker.windowLoseFocus(t)}),e("body").append('<div style="position:fixed; top:0; left:0; overflow:hidden;"><input style="position:absolute; left:-300px;" type="text" value="" id="focus_retriever" readonly="true" /></div>'),this.focusRetriever=e("#focus_retriever"),this.focusRetrieved=!1,e(document).mousemove(function(t){document.activeElement&&"IFRAME"==document.activeElement.tagName&&(e.iframeTracker.focusRetriever.focus(),e.iframeTracker.focusRetrieved=!0)}),this.isIE8AndOlder){this.focusRetriever.blur(function(t){t.stopPropagation(),t.preventDefault(),e.iframeTracker.windowLoseFocus(t)}),e("body").click(function(t){e(window).focus()}),e("form").click(function(e){e.stopPropagation()});try{e("body").on("click","form",function(e){e.stopPropagation()})}catch(e){console.log("[iframeTracker] Please update jQuery to 1.7 or newer. (exception: "+e.message+")")}}},track:function(t,n){n.target=t,e.iframeTracker.handlersList.push(n),e(t).bind("mouseover",{handler:n},e.iframeTracker.mouseoverListener).bind("mouseout",{handler:n},e.iframeTracker.mouseoutListener)},untrack:function(t){if("function"!=typeof Array.prototype.filter)return void console.log("Your browser doesn't support Array filter, untrack disabled");e(t).each(function(t){e(this).unbind("mouseover",e.iframeTracker.mouseoverListener).unbind("mouseout",e.iframeTracker.mouseoutListener)});var n=function(e){return null!==e};for(var s in this.handlersList){for(var l in this.handlersList[s].target)e.inArray(this.handlersList[s].target[l],t)!==-1&&(this.handlersList[s].target[l]=null);this.handlersList[s].target=this.handlersList[s].target.filter(n),0==this.handlersList[s].target.length&&(this.handlersList[s]=null)}this.handlersList=this.handlersList.filter(n)},mouseoverListener:function(e){e.data.handler.over=!0;try{e.data.handler.overCallback(this)}catch(e){}},mouseoutListener:function(t){t.data.handler.over=!1,e.iframeTracker.focusRetriever.focus();try{t.data.handler.outCallback(this)}catch(e){}},windowLoseFocus:function(e){for(var t in this.handlersList)if(1==this.handlersList[t].over)try{this.handlersList[t].blurCallback()}catch(e){}}},e(document).ready(function(){e.iframeTracker.init()})}(jQuery),define("discourse/plugins/lazyYT/initializers/lazyYT",["discourse/lib/plugin-api","exports"],function(e,t){"use strict";var n=e.withPluginApi,s=function(){return!1};t.default={name:"apply-lazyYT",initialize:function(){n("0.1",function(e){e.decorateCooked(function(t){var n=$(".lazyYT",t);0!==n.length&&$(".lazyYT",t).lazyYT({onPlay:function(t,l){var a=parseInt(l.closest("article").data("post-id"));a&&e.preventCloak(a),$("iframe",n).iframeTracker({blurCallback:function(){$(document).on("scroll.discourse-youtube",s),window.setTimeout(function(){return $(document).off("scroll.discourse-youtube",s)},1500),$(document).scroll()}})}})})})}}}),define("discourse/plugins/poll/lib/discourse-markdown/poll",["pretty-text/pretty-text","exports"],function(e,t){"use strict";function n(e){e.whiteList(["div.poll","div.poll-info","div.poll-container","div.poll-buttons","div[data-*]","span.info-number","span.info-text","a.button.cast-votes","a.button.toggle-results","li[data-*]"]),e.replaceBlock({start:/\[poll((?:\s+\w+=[^\s\]]+)*)\]([\s\S]*)/gim,stop:/\[\/poll\]/gim,emitter:function(t,n){var s=this,l=[];if(t.length)for(var a=function(e){if("string"==typeof e||e instanceof String){var t=s.processInline(String(e));t.length&&l.push(["p"].concat(t))}else l.push(e)},o=void 0;void 0!==(o=t.shift());)this.processBlock(o,t).forEach(a);var i={class:"poll"};i[x+"status"]="open",i[x+"name"]=b,(n[1].match(y)||[]).forEach(function(t){var n=t.split("="),s=h(n,2),l=s[0],a=s[1],o=e.escape(a.replace(/["']/g,""));i[x+l]=o});var r=parseInt(i[x+"min"],10),u=parseInt(i[x+"max"],10),c=parseInt(i[x+"step"],10);if("number"===i[x+"type"]){isNaN(r)&&(r=1),isNaN(u)&&(u=e.getOptions().pollMaximumOptions),isNaN(c)&&(c=1),l.push(["bulletlist"]);for(var p=r;p<=u;p+=c)l[0].push(["listitem",String(p)])}if(1!==l.length||l[0].length<=1||"numberlist"!==l[0][0]&&"bulletlist"!==l[0][0])return["div"].concat(l);for(var p=1;p<l[0].length;p++)if("listitem"!==l[0][p][0])return["div"].concat(l);for(var p=1;p<l[0].length;p++){var d={};d[x+"option-id"]=f(JSON.stringify(l[0][p].slice(1))),l[0][p].splice(1,0,d)}var m=["div",i],g=["div"],v=["div",{class:"poll-container"}].concat(l);g.push(v);var k=["div",{class:"poll-info"}];if(k.push(["p",["span",{class:"info-number"},"0"],["span",{class:"info-text"},I18n.t("poll.voters",{count:0})]]),"multiple"===i[x+"type"]){var E=l[0].length-1;(isNaN(r)||r<1)&&(r=1),(isNaN(u)||u>E)&&(u=E);var w=void 0;u>0&&(r===u?r>1&&(w=I18n.t("poll.multiple.help.x_options",{count:r})):r>1?w=u<E?I18n.t("poll.multiple.help.between_min_and_max_options",{min:r,max:u}):I18n.t("poll.multiple.help.at_least_min_options",{count:r}):u<=E&&(w=I18n.t("poll.multiple.help.up_to_max_options",{count:u}))),w&&k.push(["p",w])}"true"===i[x+"public"]&&k.push(["p",I18n.t("poll.public.title")]),g.push(k);var _=["div",{class:"poll-buttons"}];return"multiple"===i[x+"type"]&&_.push(["a",{class:"button cast-votes",title:I18n.t("poll.cast-votes.title")},I18n.t("poll.cast-votes.label")]),_.push(["a",{class:"button toggle-results",title:I18n.t("poll.show-results.title")},I18n.t("poll.show-results.label")]),m.push(g),m.push(_),m}})}function s(e,t){var n=e[0],s=e[1],l=e[2],u=e[3];n=a(n,s,l,u,t[0],7,-680876936),u=a(u,n,s,l,t[1],12,-389564586),l=a(l,u,n,s,t[2],17,606105819),s=a(s,l,u,n,t[3],22,-1044525330),n=a(n,s,l,u,t[4],7,-176418897),u=a(u,n,s,l,t[5],12,1200080426),l=a(l,u,n,s,t[6],17,-1473231341),s=a(s,l,u,n,t[7],22,-45705983),n=a(n,s,l,u,t[8],7,1770035416),u=a(u,n,s,l,t[9],12,-1958414417),l=a(l,u,n,s,t[10],17,-42063),s=a(s,l,u,n,t[11],22,-1990404162),n=a(n,s,l,u,t[12],7,1804603682),u=a(u,n,s,l,t[13],12,-40341101),l=a(l,u,n,s,t[14],17,-1502002290),s=a(s,l,u,n,t[15],22,1236535329),n=o(n,s,l,u,t[1],5,-165796510),u=o(u,n,s,l,t[6],9,-1069501632),l=o(l,u,n,s,t[11],14,643717713),s=o(s,l,u,n,t[0],20,-373897302),n=o(n,s,l,u,t[5],5,-701558691),u=o(u,n,s,l,t[10],9,38016083),l=o(l,u,n,s,t[15],14,-660478335),s=o(s,l,u,n,t[4],20,-405537848),n=o(n,s,l,u,t[9],5,568446438),u=o(u,n,s,l,t[14],9,-1019803690),l=o(l,u,n,s,t[3],14,-187363961),s=o(s,l,u,n,t[8],20,1163531501),n=o(n,s,l,u,t[13],5,-1444681467),u=o(u,n,s,l,t[2],9,-51403784),l=o(l,u,n,s,t[7],14,1735328473),s=o(s,l,u,n,t[12],20,-1926607734),n=i(n,s,l,u,t[5],4,-378558),u=i(u,n,s,l,t[8],11,-2022574463),l=i(l,u,n,s,t[11],16,1839030562),s=i(s,l,u,n,t[14],23,-35309556),n=i(n,s,l,u,t[1],4,-1530992060),u=i(u,n,s,l,t[4],11,1272893353),l=i(l,u,n,s,t[7],16,-155497632),s=i(s,l,u,n,t[10],23,-1094730640),n=i(n,s,l,u,t[13],4,681279174),u=i(u,n,s,l,t[0],11,-358537222),l=i(l,u,n,s,t[3],16,-722521979),s=i(s,l,u,n,t[6],23,76029189),n=i(n,s,l,u,t[9],4,-640364487),u=i(u,n,s,l,t[12],11,-421815835),l=i(l,u,n,s,t[15],16,530742520),s=i(s,l,u,n,t[2],23,-995338651),n=r(n,s,l,u,t[0],6,-198630844),u=r(u,n,s,l,t[7],10,1126891415),l=r(l,u,n,s,t[14],15,-1416354905),s=r(s,l,u,n,t[5],21,-57434055),n=r(n,s,l,u,t[12],6,1700485571),u=r(u,n,s,l,t[3],10,-1894986606),l=r(l,u,n,s,t[10],15,-1051523),s=r(s,l,u,n,t[1],21,-2054922799),n=r(n,s,l,u,t[8],6,1873313359),u=r(u,n,s,l,t[15],10,-30611744),l=r(l,u,n,s,t[6],15,-1560198380),s=r(s,l,u,n,t[13],21,1309151649),n=r(n,s,l,u,t[4],6,-145523070),u=r(u,n,s,l,t[11],10,-1120210379),l=r(l,u,n,s,t[2],15,718787259),s=r(s,l,u,n,t[9],21,-343485551),e[0]=m(n,e[0]),e[1]=m(s,e[1]),e[2]=m(l,e[2]),e[3]=m(u,e[3])}function l(e,t,n,s,l,a){return t=m(m(t,e),m(s,a)),m(t<<l|t>>>32-l,n)}function a(e,t,n,s,a,o,i){return l(t&n|~t&s,e,t,a,o,i)}function o(e,t,n,s,a,o,i){return l(t&s|n&~s,e,t,a,o,i)}function i(e,t,n,s,a,o,i){return l(t^n^s,e,t,a,o,i)}function r(e,t,n,s,a,o,i){return l(n^(t|~s),e,t,a,o,i)}function u(e){/[\x80-\xFF]/.test(e)&&(e=unescape(encodeURI(e)));var t,n=e.length,l=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)s(l,c(e.substring(t-64,t)));e=e.substring(t-64);var a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)a[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(a[t>>2]|=128<<(t%4<<3),t>55)for(s(l,a),t=0;t<16;t++)a[t]=0;return a[14]=8*n,s(l,a),l}function c(e){var t,n=[];for(t=0;t<64;t+=4)n[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return n}function p(e){for(var t="",n=0;n<4;n++)t+=k[e>>8*n+4&15]+k[e>>8*n&15];return t}function d(e){for(var t=0;t<e.length;t++)e[t]=p(e[t]);return e.join("")}function m(e,t){return e+t&4294967295}function f(e){return d(u(e))}var h=function(){function e(e,t){var n=[],s=!0,l=!1,a=void 0;try{for(var o,i=e[Symbol.iterator]();!(s=(o=i.next()).done)&&(n.push(o.value),!t||n.length!==t);s=!0);}catch(e){l=!0,a=e}finally{try{!s&&i.return&&i.return()}finally{if(l)throw a}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();t.setup=n;var g=e.registerOption,x="data-poll-",b="poll",v=["type","name","min","max","step","order","status","public"],y=new RegExp("("+v.join("|")+")=['\"]?[^\\s\\]]+['\"]?","g");g(function(e,t){var n=t.getCurrentUser&&t.getCurrentUser(t.userId)||t.currentUser,s=n&&n.staff;t.features.poll=!!e.poll_enabled||s,t.pollMaximumOptions=e.poll_maximum_options});var k="0123456789abcdef".split("")}),define("discourse/plugins/poll/lib/even-round",["exports"],function(e){"use strict";function t(e){return 100===e.map(function(e){return Math.floor(e)}).reduce(function(e,t){return e+t})}e.default=function(e){for(var n=e.map(function(e){return e%1}),s=Math.ceil(n.reduce(function(e,t){return e+t})),l=0,a=n.length;l<s&&l<a;l++){for(var o=0,i=0,r=0;r<n.length;r++)n[r]>o&&(i=r,o=n[r]);if(++e[i],n[i]=0,t(e))break}return e.map(function(e){return Math.floor(e)})}}),define("discourse/plugins/poll/controllers/poll-ui-builder",["ember-addons/ember-computed-decorators","discourse/models/input-validation","exports"],function(e,t,n){"use strict";function s(e){for(var t={},n=0;n<e.length;n++){var s=e[n],l=s.decorators,a=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),l)for(var o=0;o<l.length;o++){var i=l[o];if("function"!=typeof i)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof i);s=i(t,a,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,a,s)}return t}var l=e.default,a=e.observes,o=t.default;n.default=Ember.Controller.extend(s([{key:"numberPollType",initializer:function(){return"number"}},{key:"multiplePollType",initializer:function(){return"multiple"}},{key:"init",value:function(){this._super(),this._setupPoll()}},{key:"pollTypes",
decorators:[l("numberPollType","multiplePollType")],value:function(e,t){var n=[];return n.push({name:I18n.t("poll.ui_builder.poll_type.number"),value:e}),n.push({name:I18n.t("poll.ui_builder.poll_type.multiple"),value:t}),n}},{key:"isMultiple",decorators:[l("pollType","pollOptionsCount","multiplePollType")],value:function(e,t,n){return e===n&&t>0}},{key:"isNumber",decorators:[l("pollType","numberPollType")],value:function(e,t){return e===t}},{key:"showMinMax",decorators:[l("isNumber","isMultiple")],value:function(e,t){return e||t}},{key:"pollOptionsCount",decorators:[l("pollOptions")],value:function(e){if(0===e.length)return 0;var t=0;return e.split("\n").forEach(function(e){0!==e.length&&(t+=1)}),t}},{key:"_setPollMax",decorators:[a("isMultiple","isNumber","pollOptionsCount")],value:function(){var e=this.get("isMultiple"),t=this.get("isNumber");(e||t)&&(e?this.set("pollMax",this.get("pollOptionsCount")):t&&this.set("pollMax",this.siteSettings.poll_maximum_options))}},{key:"pollMinOptions",decorators:[l("isMultiple","isNumber","pollOptionsCount")],value:function(e,t,n){if(e||t)return e?this._comboboxOptions(1,n+1):t?this._comboboxOptions(1,this.siteSettings.poll_maximum_options+1):void 0}},{key:"pollMaxOptions",decorators:[l("isMultiple","isNumber","pollOptionsCount","pollMin","pollStep")],value:function(e,t,n,s,l){if(e||t){var a=parseInt(s)||1;if(e)return this._comboboxOptions(a+1,n+1);if(t){var o=parseInt(l)||1;return this._comboboxOptions(a+1,a+this.siteSettings.poll_maximum_options*o)}}}},{key:"pollStepOptions",decorators:[l("isNumber","pollMax")],value:function(e,t){if(e)return this._comboboxOptions(1,(parseInt(t)||1)+1)}},{key:"pollOutput",decorators:[l("isNumber","showMinMax","pollType","publicPoll","pollOptions","pollMin","pollMax","pollStep")],value:function(e,t,n,s,l,a,o,i){var r="[poll",u="",c=this.get("toolbarEvent").getText().match(/\[poll(\s+name=[^\s\]]+)*.*\]/gim);return c&&(r+=" name=poll"+(c.length+1)),n&&(r+=" type="+n),a&&t&&(r+=" min="+a),o&&(r+=" max="+o),e&&(r+=" step="+i),s&&(r+=" public=true"),r+="]",u+=r+"\n",l.length>0&&!e&&l.split("\n").forEach(function(e){0!==e.length&&(u+="* "+e+"\n")}),u+="[/poll]"}},{key:"disableInsert",decorators:[l("pollOptionsCount","isNumber")],value:function(e,t){return!t&&e<2}},{key:"minNumOfOptionsValidation",decorators:[l("disableInsert")],value:function(e){var t={ok:!0};return e&&(t={failed:!0,reason:I18n.t("poll.ui_builder.help.options_count")}),o.create(t)}},{key:"_comboboxOptions",value:function(e,t){return _.range(e,t).map(function(e){return{value:e,name:e}})}},{key:"_setupPoll",value:function(){this.setProperties({pollType:null,publicPoll:!1,pollOptions:"",pollMin:1,pollMax:null,pollStep:1})}},{key:"actions",initializer:function(){return{insertPoll:function(){this.get("toolbarEvent").addText(this.get("pollOutput")),this.send("closeModal"),this._setupPoll()}}}}]))}),define("discourse/plugins/poll/initializers/extend-for-poll",["discourse/lib/plugin-api","ember-addons/ember-computed-decorators","discourse-common/lib/get-owner","discourse/widgets/glue","exports"],function(e,t,n,s,l){"use strict";function a(e){for(var t={},n=0;n<e.length;n++){var s=e[n],l=s.decorators,a=s.key;if(delete s.key,delete s.decorators,s.enumerable=!0,s.configurable=!0,("value"in s||s.initializer)&&(s.writable=!0),l)for(var o=0;o<l.length;o++){var i=l[o];if("function"!=typeof i)throw new TypeError("The decorator for method "+s.key+" is of the invalid type "+typeof i);s=i(t,a,s)||s}s.initializer&&(s.value=s.initializer.call(t)),Object.defineProperty(t,a,s)}return t}function o(e){function t(t,n){var l=$(".poll",t);if(l.length){var a=n.getModel();e.preventCloak(a.id);var o=a.get("polls_votes")||{};a.pollsChanged();var r=a.get("pollsObject");r&&l.each(function(e,t){var n=$(t),l=n.data("poll-name"),u=r[l];if(u){var p="multiple"===u.get("type"),d=new c("discourse-poll",s,{id:l+"-"+a.id,post:a,poll:u,vote:o[l]||[],isMultiple:p});d.appendTo(t),i.push(d)}})}}function n(){i.forEach(function(e){return e.cleanUp()})}var s=u(e),l=e.container.lookupFactory("controller:topic");l.reopen({subscribe:function(){var e=this;this._super(),this.messageBus.subscribe("/polls/"+this.get("model.id"),function(t){var n=e.get("model.postStream").findLoadedPost(t.post_id);n&&n.set("polls",t.polls)})},unsubscribe:function(){this.messageBus.unsubscribe("/polls/*"),this._super()}});var o=e.container.lookupFactory("model:post");o.reopen(a([{key:"_polls",initializer:function(){return null}},{key:"pollsObject",initializer:function(){return null}},{key:"pollsChanged",decorators:[r("polls")],value:function(){var e=this,t=this.get("polls");t&&(this._polls=this._polls||{},_.map(t,function(t,n){var s=e._polls[n];s?e._polls[n].setProperties(t):e._polls[n]=Em.Object.create(t)}),this.set("pollsObject",this._polls),i.forEach(function(e){return e.queueRerender()}))}}]));var i=[];e.includePostAttributes("polls","polls_votes"),e.decorateCooked(t,{onlyStream:!0}),e.cleanupStream(n)}var i=e.withPluginApi,r=t.observes,u=n.getRegister,c=s.default;l.default={name:"extend-for-poll",initialize:function(){i("0.1",o)}}}),define("discourse/plugins/poll/initializers/add-poll-ui-builder",["discourse/lib/plugin-api","discourse/lib/show-modal","exports"],function(e,t,n){"use strict";function s(e){var t=e.container.lookup("site-settings:main");if(t.poll_enabled||!e.getCurrentUser()||e.getCurrentUser().staff){var n=e.container.lookupFactory("controller:composer");n.reopen({actions:{showPollBuilder:function(){a("poll-ui-builder").set("toolbarEvent",this.get("toolbarEvent"))}}}),e.addToolbarPopupMenuOptionsCallback(function(){return{action:"showPollBuilder",icon:"bar-chart-o",label:"poll.ui_builder.title"}})}}var l=e.withPluginApi,a=t.default;n.default={name:"add-poll-ui-builder",initialize:function(){l("0.5",s)}}}),Ember.TEMPLATES["javascripts/modal/poll-ui-builder"]=Ember.HTMLBars.template({id:null,block:'{"statements":[["block",["d-modal-body"],null,[["title","class"],["poll.ui_builder.title","poll-ui-builder"]],3],["text","\\n"],["open-element","div",[]],["static-attr","class","modal-footer"],["flush-element"],["text","\\n  "],["append",["helper",["d-button"],null,[["action","icon","class","label","disabled"],["insertPoll","bar-chart-o","btn-primary","poll.ui_builder.insert",["get",["disableInsert"]]]]],false],["text","\\n"],["close-element"],["text","\\n"]],"locals":[],"named":[],"yields":[],"blocks":[{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_options.label"],null],false],["close-element"],["text","\\n        "],["append",["helper",["input-tip"],null,[["validation"],[["get",["minNumOfOptionsValidation"]]]]],false],["text","\\n        "],["append",["helper",["textarea"],null,[["value"],[["get",["pollOptions"]]]]],false],["text","\\n      "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","        "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n          "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.step"],null],false],["close-element"],["text","\\n          "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","class"],[["get",["pollStepOptions"]],["get",["pollStep"]],"value","poll-options-step"]]],false],["text","\\n        "],["close-element"],["text","\\n"]],"locals":[]},{"statements":[["text","      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.min"],null],false],["close-element"],["text","\\n        "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","class"],[["get",["pollMinOptions"]],["get",["pollMin"]],"value","poll-options-min"]]],false],["text","\\n      "],["close-element"],["text","\\n\\n\\n      "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n        "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_config.max"],null],false],["close-element"],["text","\\n        "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","class"],[["get",["pollMaxOptions"]],["get",["pollMax"]],"value","poll-options-max"]]],false],["text","\\n      "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["isNumber"]]],null,1]],"locals":[]},{"statements":[["text","  "],["open-element","form",[]],["static-attr","class","poll-ui-builder-form form-horizontal"],["flush-element"],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["static-attr","class","input-group-label"],["flush-element"],["append",["helper",["i18n"],["poll.ui_builder.poll_type.label"],null],false],["close-element"],["text","\\n      "],["append",["helper",["combo-box"],null,[["content","value","valueAttribute","none"],[["get",["pollTypes"]],["get",["pollType"]],"value","poll.ui_builder.poll_type.regular"]]],false],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["if"],[["get",["showMinMax"]]],null,2],["text","\\n    "],["open-element","div",[]],["static-attr","class","input-group"],["flush-element"],["text","\\n      "],["open-element","label",[]],["flush-element"],["text","\\n        "],["append",["helper",["input"],null,[["type","checked"],["checkbox",["get",["publicPoll"]]]]],false],["text","\\n        "],["append",["helper",["i18n"],["poll.ui_builder.poll_public.label"],null],false],["text","\\n      "],["close-element"],["text","\\n    "],["close-element"],["text","\\n\\n"],["block",["unless"],[["get",["isNumber"]]],null,0],["text","  "],["close-element"],["text","\\n"]],"locals":[]}],"hasPartials":false}',meta:{moduleName:"javascripts/modal/poll-ui-builder"}}),define("discourse/plugins/poll/widgets/discourse-poll",["discourse/widgets/widget","virtual-dom","discourse/helpers/fa-icon-node","discourse/widgets/raw-html","discourse/lib/ajax","discourse/plugins/poll/lib/even-round","discourse/widgets/post","discourse/lib/round","exports"],function(e,t,n,s,l,a,o,i,r){"use strict";function u(e){return new f({html:"<span>"+e.html+"</span>"})}function c(e){return h("/polls/voters.json",{type:"get",data:e}).catch(function(){bootbox.alert(I18n.t("poll.error_while_fetching_voters"))})}var p=e.createWidget,d=t.h,m=n.iconNode,f=s.default,h=l.ajax,g=a.default,x=o.avatarFor,b=i.default;p("discourse-poll-option",{tagName:"li",buildAttributes:function(e){return{"data-poll-option-id":e.option.id}},html:function(e){var t=[],n=e.option,s=e.vote,l=s.indexOf(n.id)!==-1;return e.isMultiple?t.push(m(l?"check-square-o":"square-o")):t.push(m(l?"dot-circle-o":"circle-o")),t.push(" "),t.push(u(n)),t},click:function(e){0===$(e.target).closest("a").length&&this.sendWidgetAction("toggleOption",this.attrs.option)}}),p("discourse-poll-load-more",{tagName:"div.poll-voters-toggle-expand",buildKey:function(e){return e.id+"-load-more"},defaultState:function(){return{loading:!1}},html:function(e,t){return t.loading?d("div.spinner.small"):d("a",m("chevron-down"))},click:function(){var e=this.state;if(!e.loading)return e.loading=!0,this.sendWidgetAction("loadMore").finally(function(){return e.loading=!1})}}),p("discourse-poll-voters",{tagName:"ul.poll-voters-list",buildKey:function(e){return e.id()},defaultState:function(){return{loaded:"new",pollVoters:[],offset:1}},fetchVoters:function(){var e=this,t=this.attrs,n=this.state;if("loading"!==n.loaded)return n.loaded="loading",c({post_id:t.postId,poll_name:t.pollName,option_id:t.optionId,offset:n.offset}).then(function(s){n.loaded="loaded",n.offset+=1;var l=s[t.pollName],a="number"===t.pollType?l:l[t.optionId];n.pollVoters=n.pollVoters.concat(a),e.scheduleRerender()})},loadMore:function(){return this.fetchVoters()},html:function(e,t){e.pollVoters&&"new"===t.loaded&&(t.pollVoters=e.pollVoters);var n=t.pollVoters.map(function(e){return d("li",[x("tiny",{username:e.username,template:e.avatar_template})," "])});return t.pollVoters.length<e.totalVotes&&n.push(this.attach("discourse-poll-load-more",{id:e.id()})),d("div.poll-voters",n)}}),p("discourse-poll-standard-results",{tagName:"ul.results",buildKey:function(e){return e.id+"-standard-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var e=this,t=this.attrs,n=this.state;"new"===n.loaded&&c({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(s){n.voters=s[t.poll.get("name")],n.loaded="loaded",e.scheduleRerender()})},html:function(e,t){var n=this,s=e.poll,l=s.get("options");if(l){var a=function(){var a=s.get("voters"),o=s.get("public"),i=_.clone(l).sort(function(e,t){return e.votes<t.votes?1:e.votes===t.votes?e.html<t.html?-1:1:-1}),r=0===a?Array(i.length).fill(0):i.map(function(e){return 100*e.votes/a}),c=e.isMultiple?r.map(Math.floor):g(r);return o&&n.fetchVoters(),{v:i.map(function(l,a){var i=[],r=c[a].toString(),p=(e.vote||[]).includes(l.id);return i.push(d("div.option",d("p",[d("span.percentage",r+"%"),u(l)]))),i.push(d("div.bar-back",d("div.bar",{attributes:{style:"width:"+r+"%"}}))),o&&i.push(n.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+l.id},postId:e.post.id,optionId:l.id,pollName:s.get("name"),totalVotes:l.votes,pollVoters:t.voters&&t.voters[l.id]||[]})),d("li",{className:""+(p?"chosen":"")},i)})}}();if("object"==typeof a)return a.v}}}),p("discourse-poll-number-results",{buildKey:function(e){return e.id+"-number-results"},defaultState:function(){return{loaded:"new"}},fetchVoters:function(){var e=this,t=this.attrs,n=this.state;"new"===n.loaded&&c({post_id:t.post.id,poll_name:t.poll.get("name")}).then(function(s){n.voters=s[t.poll.get("name")],n.loaded="loaded",e.scheduleRerender()})},html:function(e,t){var n=e.poll,s=n.get("public"),l=n.get("options").reduce(function(e,t){return e+parseInt(t.html,10)*parseInt(t.votes,10)},0),a=n.voters,o=0===a?0:b(l/a,-2),i=I18n.t("poll.average_rating",{average:o}),r=[d("div.poll-results-number-rating",new f({html:"<span>"+i+"</span>"}))];return s&&(this.fetchVoters(),r.push(this.attach("discourse-poll-voters",{id:function(){return"poll-voters-"+n.get("name")},totalVotes:n.get("voters"),pollVoters:t.voters||[],postId:e.post.id,pollName:n.get("name"),pollType:n.get("type")}))),r}}),p("discourse-poll-container",{tagName:"div.poll-container",html:function(e){var t=this,n=e.poll;if(e.showResults){var s="number"===n.get("type")?"number":"standard";return this.attach("discourse-poll-"+s+"-results",e)}var l=n.get("options");if(l)return d("ul",l.map(function(n){return t.attach("discourse-poll-option",{option:n,isMultiple:e.isMultiple,vote:e.vote})}))}}),p("discourse-poll-info",{tagName:"div.poll-info",multipleHelpText:function(e,t,n){if(t>0)if(e===t){if(e>1)return I18n.t("poll.multiple.help.x_options",{count:e})}else{if(e>1)return t<n?I18n.t("poll.multiple.help.between_min_and_max_options",{min:e,max:t}):I18n.t("poll.multiple.help.at_least_min_options",{count:e});if(t<=n)return I18n.t("poll.multiple.help.up_to_max_options",{count:t})}},html:function(e){var t=e.poll,n=t.get("voters"),s=[d("p",[d("span.info-number",n.toString()),d("span.info-text",I18n.t("poll.voters",{count:n}))])];if(e.isMultiple)if(e.showResults){var l=t.get("options").reduce(function(e,t){return e+parseInt(t.votes,10)},0);s.push(d("p",[d("span.info-number",l.toString()),d("span.info-text",I18n.t("poll.total_votes",{count:l}))]))}else{var a=this.multipleHelpText(e.min,e.max,t.get("options.length"));a&&s.push(new f({html:"<span>"+a+"</span>"}))}return!e.showResults&&e.poll.get("public")&&s.push(d("p",I18n.t("poll.public.title"))),s}}),p("discourse-poll-buttons",{tagName:"div.poll-buttons",html:function(e){var t=[],n=e.poll,s=e.post,l=s.get("topic.archived"),a="closed"===n.get("status"),o=a||l;if(e.isMultiple&&!o){var i=!e.canCastVotes;t.push(this.attach("button",{className:"btn cast-votes "+(i?"":"btn-primary"),label:"poll.cast-votes.label",title:"poll.cast-votes.title",disabled:i,action:"castVotes"})),t.push(" ")}return e.showResults?t.push(this.attach("button",{className:"btn toggle-results",label:"poll.hide-results.label",title:"poll.hide-results.title",icon:"eye-slash",disabled:o,action:"toggleResults"})):t.push(this.attach("button",{className:"btn toggle-results",label:"poll.show-results.label",title:"poll.show-results.title",icon:"eye",disabled:0===n.get("voters"),action:"toggleResults"})),!this.currentUser||this.currentUser.get("id")!==s.get("user_id")&&!this.currentUser.get("staff")||l||(a?t.push(this.attach("button",{className:"btn toggle-status",label:"poll.open.label",title:"poll.open.title",icon:"unlock-alt",action:"toggleStatus"})):t.push(this.attach("button",{className:"btn toggle-status btn-danger",label:"poll.close.label",title:"poll.close.title",icon:"lock",action:"toggleStatus"}))),t}}),r.default=p("discourse-poll",{tagName:"div.poll",buildKey:function(e){return e.id},buildAttributes:function(e){var t=e.poll;return{"data-poll-type":t.get("type"),"data-poll-name":t.get("name"),"data-poll-status":t.get("status"),"data-poll-public":t.get("public")}},defaultState:function(e){var t=e.poll,n=e.post;return{loading:!1,showResults:t.get("isClosed")||n.get("topic.archived")}},html:function(e,t){var n=t.showResults,s=jQuery.extend({},e,{showResults:n,canCastVotes:this.canCastVotes(),min:this.min(),max:this.max()});return d("div",[this.attach("discourse-poll-container",s),this.attach("discourse-poll-info",s),this.attach("discourse-poll-buttons",s)])},isClosed:function(){return"closed"===this.attrs.poll.get("status")},min:function(){var e=parseInt(this.attrs.poll.min,10);return(isNaN(e)||e<1)&&(e=1),e},max:function(){var e=parseInt(this.attrs.poll.max,10),t=this.attrs.poll.options.length;return(isNaN(e)||e>t)&&(e=t),e},canCastVotes:function(){var e=this.state,t=this.attrs;if(this.isClosed()||e.showResults||e.loading)return!1;var n=t.vote.length;return t.isMultiple?n>=this.min()&&n<=this.max():n>0},toggleStatus:function(){var e=this,t=this.state,n=this.attrs,s=n.poll,l="closed"===s.get("status");bootbox.confirm(I18n.t(l?"poll.open.confirm":"poll.close.confirm"),I18n.t("no_value"),I18n.t("yes_value"),function(a){a&&!function(){t.loading=!0;var a=l?"open":"closed";h("/polls/toggle_status",{type:"PUT",data:{post_id:n.post.get("id"),poll_name:s.get("name"),status:a}}).then(function(){s.set("status",a),e.scheduleRerender()}).catch(function(){bootbox.alert(I18n.t("poll.error_while_toggling_status"))}).finally(function(){t.loading=!1})}()})},toggleResults:function(){this.state.showResults=!this.state.showResults},showLogin:function(){var e=this.register.lookup("route:application");e.send("showLogin")},toggleOption:function(e){if(!this.isClosed()){this.currentUser||this.showLogin();var t=this.attrs,n=t.vote,s=n.indexOf(e.id);return t.isMultiple||(n.length=0),s!==-1?n.splice(s,1):n.push(e.id),t.isMultiple?void 0:this.castVotes()}},castVotes:function(){if(this.canCastVotes()){if(!this.currentUser)return this.showLogin();var e=this.attrs,t=this.state;return t.loading=!0,h("/polls/vote",{type:"PUT",data:{post_id:e.post.id,poll_name:e.poll.name,options:e.vote}}).then(function(){t.showResults=!0}).catch(function(){bootbox.alert(I18n.t("poll.error_while_casting_votes"))}).finally(function(){t.loading=!1})}}})});
//# sourceMappingURL=https://cdn-enterprise.discourse.org/sitepoint/community/assets/plugin-92f2d4ca276d19e7a16401adae71dd7c60aef2d86cfab5edc9941f54de832977.js.map